import{k as Oe,l as de,g as w,m as Y,p as le,q as H,c as u,b as _,o as d,d as e,i as N,s as De,v as R,x as Ve,t as f,F as Q,r as Z,y as Ue,n as G,j as q,f as te,h as ne,z as ue,u as et,A as tt,B as ot,C as st,e as F}from"./index-Drmr0K2a-1761100835368.js";import{o as at}from"./ordersApi-CSK52s1q-1761100835368.js";import{c as pe}from"./customersApi-yHCl6Tu2-1761100835368.js";import{_ as Le}from"./_plugin-vue_export-helper-DlAUqK2U-1761100835368.js";import{r as we,v as lt,c as nt,s as rt}from"./cashDenominations-Cv48tYhz-1761100835368.js";const it=Oe("cart",{state:()=>({items:[],payments:[],customer:null,documentType:"boleta",status:"ABIERTO",currentSaleId:null,unsavedChanges:!1,roundingAdjustment:0,pendingAuthorization:null}),getters:{isOpen:t=>t.status==="ABIERTO",isBlocked:t=>t.status==="BLOQUEADO",isPaid:t=>t.status==="PAGADO",isFinalized:t=>t.status==="FINALIZADO",canAddProducts:t=>["ABIERTO","BLOQUEADO"].includes(t.status),canEditQuantity:t=>t.status==="ABIERTO",canRemoveProducts:t=>t.status==="ABIERTO",canAddPayments:t=>["ABIERTO","BLOQUEADO"].includes(t.status),canRemovePayments:t=>!1,requiresSupervisorForEdit:t=>t.status!=="ABIERTO",requiresSupervisorForRemove:t=>t.status!=="ABIERTO",subtotal:t=>t.items.reduce((l,o)=>{const i=parseFloat(o.precio)||0,r=parseInt(o.quantity)||0;return l+i*r},0),tax(t){return this.subtotal*.18},total(t){return this.subtotal+this.tax},totalWithRounding(t){return this.total+t.roundingAdjustment},totalPaid:t=>t.payments.reduce((l,o)=>l+parseFloat(o.amount||0),0),remainingAmount(t){const l=t.roundingAdjustment!==0?this.totalWithRounding:this.total;return Math.max(0,Math.round((l-this.totalPaid)*100)/100)},totalChange:t=>{const l=t.payments.filter(i=>i.method==="efectivo");let o=0;return l.forEach(i=>{var c;const r=(c=i.reference)==null?void 0:c.match(/Cambio: S\/\s*([\d.]+)/);r&&(o+=parseFloat(r[1]))}),Math.round(o*100)/100},isFullyPaid(t){return this.remainingAmount<=.01},hasItems:t=>t.items.length>0,hasPayments:t=>t.payments.length>0,hasCustomer:t=>t.customer!==null,isEmpty:t=>t.items.length===0&&t.payments.length===0,statusLabel:t=>({ABIERTO:"Abierto",BLOQUEADO:"Bloqueado",PAGADO:"Pagado",FINALIZADO:"Finalizado"})[t.status]||t.status,statusColor:t=>({ABIERTO:"green",BLOQUEADO:"yellow",PAGADO:"blue",FINALIZADO:"gray"})[t.status]||"gray"},actions:{addItem(t,l=null){if(console.log("🛒 [CART] addItem called:",{product:t.nombre,status:this.status,canAddProducts:this.canAddProducts,hasAuthorization:!!l,authData:l}),!this.canAddProducts&&!l)throw console.error("❌ [CART] Cannot add products - invalid state"),new Error("No se pueden agregar productos. Carrito en estado: "+this.status);if(this.status==="BLOQUEADO"&&!l)throw console.error("❌ [CART] Cart blocked - requires authorization"),new Error("Carrito bloqueado. Se requiere PIN del cajero para agregar productos.");const o=this.items.find(i=>i.id===t.id);if(o){if(o.quantity>=t.stock)throw new Error("No hay suficiente stock disponible");o.quantity++}else this.items.push({...t,quantity:1});this.unsavedChanges=!0,l&&this._logAudit("ADD_ITEM_BLOCKED",l,{productId:t.id})},updateItemQuantity(t,l,o=null){if(!this.canEditQuantity&&!o)throw new Error("Requiere PIN del cajero para editar cantidades en carrito bloqueado");const i=this.items.find(c=>c.id===t);if(!i)throw new Error("Producto no encontrado en el carrito");if(l>i.stock)throw new Error("No hay suficiente stock disponible");if(l<=0)throw new Error("La cantidad debe ser mayor a 0. Use removeItem para eliminar.");i.quantity=l,this.unsavedChanges=!0,o&&this._logAudit("UPDATE_QUANTITY_BLOCKED",o,{productId:t,newQuantity:l})},incrementQuantity(t,l=null){const o=this.items.find(i=>i.id===t);o&&this.updateItemQuantity(t,o.quantity+1,l)},decrementQuantity(t,l=null){const o=this.items.find(i=>i.id===t);o&&o.quantity>1&&this.updateItemQuantity(t,o.quantity-1,l)},removeItem(t,l=null){if(console.log("🗑️ [CART] removeItem called:",{productId:t,status:this.status,canRemoveProducts:this.canRemoveProducts,hasSupervisorAuth:!!l,authData:l}),!this.canRemoveProducts&&!l)throw console.error("❌ [CART] Cannot remove - requires supervisor authorization"),new Error("Requiere PIN de supervisor para eliminar productos del carrito bloqueado");if(l&&!["supervisor","administrador"].includes(l.role))throw console.error("❌ [CART] Invalid role for removal:",l.role),new Error("Solo supervisores y administradores pueden eliminar productos del carrito bloqueado");console.log("✅ [CART] Item removed successfully"),this.items=this.items.filter(o=>o.id!==t),this.unsavedChanges=!0,l&&this._logAudit("REMOVE_ITEM",l,{productId:t}),this.items.length===0&&this.payments.length===0&&(this.status="ABIERTO")},addPayment(t){if(!this.canAddPayments)throw new Error("No se pueden agregar pagos en estado: "+this.status);if(t.amount>this.remainingAmount&&t.method!=="efectivo")throw new Error("El monto del pago excede el total restante");this.payments.push({...t,timestamp:new Date().toISOString()}),t.method==="efectivo"&&this.payments.length===1&&t.roundingAmount&&(this.roundingAdjustment=t.roundingAmount,console.log("💰 [CART] Redondeo aplicado:",this.roundingAdjustment)),this.payments.length===1&&this.status==="ABIERTO"&&(this.status="BLOQUEADO"),this.isFullyPaid&&(this.status="PAGADO"),this.unsavedChanges=!0},removePayment(t,l){if(!l)throw new Error("Requiere PIN de supervisor para eliminar pagos");if(t<0||t>=this.payments.length)throw new Error("Índice de pago inválido");const o=this.payments[t];this.payments.splice(t,1),this._logAudit("REMOVE_PAYMENT",l,{paymentIndex:t,payment:o}),this.payments.length===0?this.status="ABIERTO":this.isFullyPaid||(this.status="BLOQUEADO"),this.unsavedChanges=!0},setCustomer(t){this.customer=t,this.unsavedChanges=!0},removeCustomer(){this.customer=null,this.unsavedChanges=!0},setDocumentType(t){if(!["boleta","factura"].includes(t))throw new Error("Tipo de documento inválido");this.documentType=t,this.unsavedChanges=!0},async completeSale(){if(this.status!=="PAGADO")throw new Error("La venta debe estar pagada completamente antes de finalizar");if(!this.hasCustomer)throw new Error("Debe seleccionar un cliente antes de finalizar");return this.status="FINALIZADO",this.unsavedChanges=!1,{success:!0,saleId:this.currentSaleId}},reset(){this.items=[],this.payments=[],this.customer=null,this.documentType="boleta",this.status="ABIERTO",this.currentSaleId=null,this.unsavedChanges=!1,this.pendingAuthorization=null,this.roundingAdjustment=0},startNewSale(){this.reset()},getSnapshot(){return{items:[...this.items],payments:[...this.payments],customer:this.customer?{...this.customer}:null,documentType:this.documentType,status:this.status,timestamp:new Date().toISOString()}},restoreSnapshot(t){this.items=[...t.items],this.payments=[...t.payments],this.customer=t.customer?{...t.customer}:null,this.documentType=t.documentType||"boleta",this.status=t.status||"ABIERTO",this.unsavedChanges=!1},_logAudit(t,l,o={}){console.log("🔐 AUDIT LOG:",{action:t,employee_id:l==null?void 0:l.employeeId,employee_name:l==null?void 0:l.employeeName,role:l==null?void 0:l.role,cart_status:this.status,timestamp:new Date().toISOString(),...o})},formatCurrency(t){return isNaN(t)||t===null||t===void 0?"S/ 0.00":new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(t)}}}),ke={async getProducts(t={}){const l=new URLSearchParams;t.page&&l.append("page",t.page.toString()),t.limit&&l.append("limit",t.limit.toString()),t.search&&l.append("search",t.search),t.category_id&&l.append("category_id",t.category_id.toString()),t.brand_id&&l.append("brand_id",t.brand_id.toString()),t.published!==null&&t.published!==void 0&&l.append("published",t.published?"1":"0"),t.stock_status&&t.stock_status!=="all"&&l.append("stock_status",t.stock_status);const i=(await de.get(`/products?${l.toString()}`)).data;return Array.isArray(i)?{success:!0,data:i.map(r=>{const c=(r.images||[]).filter(a=>{const y=typeof a=="string"?a:a.url||a;return y&&!y.includes("placeholder.com")}).map((a,y)=>typeof a=="string"?{id:y,url:a,thumbnail:a,position:y,is_main:y===0}:{id:a.id||y,url:a.url||a,thumbnail:a.thumbnail||a.url||a,position:a.position||y,is_main:a.is_main||y===0});return{id:r.id,sku:r.sku,name:r.name,description:r.description||"",price:parseFloat(r.price||"0"),stock:r.stock||0,published:r.published||!1,featured:r.featured||!1,images:c,category:r.category||null,brand:r.brand||null,created_at:r.created_at||new Date().toISOString(),updated_at:r.updated_at||new Date().toISOString()}}),meta:{page:t.page||1,limit:t.limit||20,total:i.length,totalPages:1,hasMore:i.length>=(t.limit||20)}}:{success:!1,data:[],meta:{page:1,limit:20,total:0,totalPages:0,hasMore:!1}}},async getProduct(t){var i;const l=await de.get(`/products/${t}`),o=((i=l.data)==null?void 0:i.data)||l.data;if(o){const r=(o.images||[]).filter(a=>{const y=typeof a=="string"?a:a.url||a;return y&&!y.includes("placeholder.com")}).map((a,y)=>typeof a=="string"?{id:y,url:a,thumbnail:a,position:y,is_main:y===0}:{id:a.id||y,url:a.url||a,thumbnail:a.thumbnail||a.url||a,position:a.position||y,is_main:a.is_main||y===0});return{success:!0,data:{id:o.id,sku:o.sku,name:o.name,description:o.description||"",price:parseFloat(o.price||"0"),stock:o.stock||0,published:o.published||!1,featured:o.featured||!1,images:r,category:o.category||null,brand:o.brand||null,created_at:o.created_at||new Date().toISOString(),updated_at:o.updated_at||new Date().toISOString()}}}return{success:!1,data:void 0}},async updateStock(t,l){return(await de.put(`/products/${t}`,{stock:l})).data},async searchByCode(t){const o=(await de.get(`/products?search=${encodeURIComponent(t)}`)).data;return Array.isArray(o)&&o.length>0?{success:!0,data:o[0]}:{success:!1,data:null,message:"Producto no encontrado"}}};let ee=[{id:1,tipoDoc:"DNI",numDoc:"12345678",nombres:"Juan",apellidos:"Pérez López",direccion:"Av. Example 123",email:"juan@ejemplo.com",telefono:"987654321",ultimaCompra:"2025-03-10T15:30:00Z"},{id:2,tipoDoc:"RUC",numDoc:"20123456789",razonSocial:"Empresa Ejemplo S.A.C.",direccion:"Jr. Business 456",email:"contacto@empresa.com",telefono:"912345678",ultimaCompra:"2025-03-09T14:20:00Z"}];const ut={async getCustomers({search:t="",tipoDoc:l="",numDoc:o=""}={}){return await new Promise(i=>setTimeout(i,300)),{data:ee.filter(i=>{var y,k,V;const r=l?i.tipoDoc===l:!0,c=o?i.numDoc.includes(o):!0,a=t?((y=i.nombres)==null?void 0:y.toLowerCase().includes(t.toLowerCase()))||((k=i.apellidos)==null?void 0:k.toLowerCase().includes(t.toLowerCase()))||((V=i.razonSocial)==null?void 0:V.toLowerCase().includes(t.toLowerCase())):!0;return r&&c&&a})}},async getCustomerByDoc(t,l){return await new Promise(i=>setTimeout(i,100)),{data:ee.find(i=>i.tipoDoc===t&&i.numDoc===l)||null}},async addCustomer(t){await new Promise(o=>setTimeout(o,500));const l={id:Math.max(...ee.map(o=>o.id))+1,...t,ultimaCompra:new Date().toISOString()};return ee.push(l),{data:l}},async updateCustomer(t,l){await new Promise(r=>setTimeout(r,300));const o=ee.findIndex(r=>r.id===t);if(o===-1)throw new Error("Cliente no encontrado");const i={...ee[o],...l};return ee[o]=i,{data:i}},async deleteCustomer(t){if(await new Promise(o=>setTimeout(o,300)),ee.findIndex(o=>o.id===t)===-1)throw new Error("Cliente no encontrado");return ee=ee.filter(o=>o.id!==t),{data:{success:!0}}}},ze=Oe("savedSales",()=>{const t=w(JSON.parse(localStorage.getItem("savedSales"))||[]);Y(t,a=>{localStorage.setItem("savedSales",JSON.stringify(a))},{deep:!0});function l(a){const y=Date.now().toString(),k=new Date().toISOString();return t.value.push({id:y,timestamp:k,...a}),y}function o(){return t.value}function i(a){return t.value.find(y=>y.id===a)}function r(a){t.value=t.value.filter(y=>y.id!==a)}function c(a,y){const k=t.value.findIndex(V=>V.id===a);if(k!==-1){const V=t.value[k].id,j=t.value[k].timestamp;t.value[k]={id:V,timestamp:j,...y}}}return{savedSales:t,saveSale:l,getSavedSales:o,getSaleById:i,deleteSavedSale:r,updateSale:c}}),dt={async registerMovement(t){try{const l=await de.post("/cash-register-shifts/movements",t);return{success:l.data.success,data:l.data.data}}catch(l){throw console.error("Error registering movement:",l),l}},async registerSale(t,l,o,i,r=null){const c=r?`Cliente: ${r}`:null;return await this.registerMovement({turnocaja_id:t,tipo:"venta",metodo_pago:l,monto:o,concepto:"Venta POS",referencia:i,notas:c})},async registerIncome(t,l,o,i=null){return await this.registerMovement({turnocaja_id:t,tipo:"entrada",metodo_pago:"efectivo",monto:l,concepto:o,notas:i})},async registerWithdrawal(t,l,o,i=null){return await this.registerMovement({turnocaja_id:t,tipo:"salida",metodo_pago:"efectivo",monto:l,concepto:o,notas:i})},async registerAdjustment(t,l,o,i=null){return await this.registerMovement({turnocaja_id:t,tipo:"ajuste",metodo_pago:"efectivo",monto:l,concepto:o,notas:i})},async getShiftMovements(t){try{const l=await de.get(`/cash-register-shifts/${t}/movements`);return{success:l.data.success,data:l.data.data}}catch(l){throw console.error("Error fetching shift movements:",l),l}},async getShiftMovementsSummary(t){try{const l=await de.get(`/cash-register-shifts/${t}/movements-summary`);return{success:l.data.success,data:l.data.data}}catch(l){throw console.error("Error fetching shift movements summary:",l),l}}},ct={key:0,class:"fixed z-10 inset-0 overflow-y-auto"},mt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},pt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},vt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},gt={class:"sm:flex sm:items-start"},ft={class:"w-full"},ht={class:"mb-4 flex gap-2 items-center"},yt=["placeholder","maxlength"],xt=["disabled"],bt={key:0,class:"mb-4"},wt={class:"overflow-x-auto"},kt={class:"min-w-full divide-y divide-gray-200"},Ct={class:"bg-white divide-y divide-gray-200"},_t={class:"px-6 py-4 whitespace-nowrap text-sm"},$t={class:"px-6 py-4 whitespace-nowrap text-sm"},St={class:"px-6 py-4 whitespace-nowrap text-sm"},At=["onClick"],Et={key:1,class:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg"},Pt={key:2,class:"mt-4 p-4 border rounded-lg bg-yellow-50"},It={class:"text-sm font-medium text-gray-800 mb-2"},Dt={class:"text-xs text-gray-600 mb-3"},Vt={class:"space-y-2"},jt={key:0},Mt={key:1},Tt={key:2},Nt=["disabled"],Rt={__name:"CustomerSearchModal",props:{modelValue:Boolean},emits:["update:modelValue","select"],setup(t,{emit:l}){const o=t,i=l,r=w("DNI"),c=w(""),a=w([]),y=w(!1),k=w(!1),V=w(!1),j=w(null),h=w(null),x=w({nombres:"",apellidos:"",razonSocial:"",correoElectronico:"",telefono:""});Y(()=>o.modelValue,E=>{E&&le(()=>{var g;(g=h.value)==null||g.focus()})});const P=H(()=>r.value==="DNI"?x.value.nombres&&x.value.apellidos:x.value.razonSocial),T=()=>{c.value="",a.value=[],y.value=!1,V.value=!1,j.value=null},O=()=>{c.value=c.value.replace(/\D/g,""),a.value=[],y.value=!1,V.value=!1},C=async()=>{if(!c.value)return;const E=r.value==="DNI"?8:11;if(c.value.length!==E){alert(`El ${r.value} debe tener ${E} dígitos`);return}if(k.value){console.log("⚠️ Already searching, skipping duplicate request");return}k.value=!0,V.value=!1,j.value=null,a.value=[],y.value=!1;try{const g=r.value==="DNI"?"1":"6";console.log(`🔍 Searching ${r.value} ${c.value} in database...`);const v=await pe.searchByDocument(c.value,g);if(console.log("📋 Search response:",v),v.success&&v.found)console.log("✅ Customer found in DB:",v.data),console.log("👤 Customer name:",v.data.name),console.log("📝 Setting searchResults to array with customer..."),a.value=[v.data],y.value=!1,V.value=!0,console.log("📊 State updated:"),console.log("   - searchResults.length:",a.value.length),console.log("   - searchResults[0]:",a.value[0]),console.log("   - showCreateForm:",y.value),console.log("   - searched:",V.value);else{console.log("Customer not in DB, looking up in Decolecta...");const D=await pe.lookupDocument(c.value,r.value.toLowerCase());if(console.log("Decolecta lookup response:",D),D.success){console.log("✅ Found in Decolecta!"),console.log("Raw lookup data:",D.data);try{j.value=D.data,a.value=[],y.value=!0,console.log("showCreateForm set to:",y.value),r.value==="DNI"?(x.value.nombres=j.value.nombres||"",x.value.apellidos=`${j.value.apellidoPaterno||""} ${j.value.apellidoMaterno||""}`.trim(),x.value.razonSocial="",console.log("Pre-filled DNI customer:",{nombres:x.value.nombres,apellidos:x.value.apellidos})):(x.value.razonSocial=j.value.razonSocial||"",x.value.nombres="",x.value.apellidos="",console.log("Pre-filled RUC customer:",{razonSocial:x.value.razonSocial})),x.value.correoElectronico="",x.value.telefono="",console.log("✅ Form successfully pre-filled")}catch(X){console.error("❌ Error pre-filling form:",X)}}else console.log("Not found in Decolecta either, showing empty form"),a.value=[],y.value=!0,x.value.nombres="",x.value.apellidos="",x.value.razonSocial="",x.value.correoElectronico="",x.value.telefono="";V.value=!0}}catch(g){console.error("Error searching customer:",g),alert("Error al buscar el cliente"),V.value=!0}finally{k.value=!1}},I=E=>{console.log("✨ Selecting customer:",E),i("select",E),$()},M=async()=>{try{const E={nombres:x.value.nombres,apellidos:x.value.apellidos,razonSocial:x.value.razonSocial,email:x.value.correoElectronico,telefono:x.value.telefono,numeroDocumento:c.value,tipoDocumento:r.value==="DNI"?"1":"6"},g=await pe.createCustomer(E);console.log("Create customer response:",g),g.success?(console.log("Customer data to select:",g.data),I(g.data)):alert(g.error||"Error al crear el cliente")}catch(E){console.error("Error creating customer:",E),alert("Error al crear el cliente")}},$=()=>{i("update:modelValue",!1),S()},S=()=>{c.value="",a.value=[],y.value=!1,k.value=!1,V.value=!1,j.value=null,x.value={nombres:"",apellidos:"",razonSocial:"",correoElectronico:"",telefono:""}};return(E,g)=>t.modelValue?(d(),u("div",ct,[e("div",mt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:$}),e("div",pt,[e("div",vt,[e("div",gt,[e("div",ft,[e("div",{class:"flex justify-between items-center mb-4"},[g[8]||(g[8]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Buscar cliente",-1)),e("button",{onClick:$,class:"text-gray-400 hover:text-gray-500 focus:outline-none"},g[7]||(g[7]=[e("svg",{class:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",ht,[N(e("select",{"onUpdate:modelValue":g[0]||(g[0]=v=>r.value=v),class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-1/4",onChange:T},g[9]||(g[9]=[e("option",{value:"DNI"},"DNI",-1),e("option",{value:"RUC"},"RUC",-1)]),544),[[De,r.value]]),N(e("input",{ref_key:"docInput",ref:h,"onUpdate:modelValue":g[1]||(g[1]=v=>c.value=v),type:"text",placeholder:r.value==="DNI"?"8 dígitos":"11 dígitos",maxlength:r.value==="DNI"?8:11,class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 flex-1",onInput:O,onKeyup:Ve(C,["enter"])},null,40,yt),[[R,c.value]]),c.value?(d(),u("button",{key:0,onClick:C,disabled:k.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"},f(k.value?"Buscando...":"Buscar"),9,xt)):_("",!0)]),a.value.length>0?(d(),u("div",bt,[g[11]||(g[11]=e("h4",{class:"text-sm font-medium text-gray-700 mb-2"},"Resultados:",-1)),e("div",wt,[e("table",kt,[g[10]||(g[10]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Nombre"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Documento"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Acciones")])],-1)),e("tbody",Ct,[(d(!0),u(Q,null,Z(a.value,v=>(d(),u("tr",{key:v.id},[e("td",_t,f(v.name||`${v.nombres||""} ${v.apellidos||""}`.trim()),1),e("td",$t,f(v.document_type==="1"?"DNI":"RUC")+": "+f(v.document_number),1),e("td",St,[e("button",{onClick:D=>I(v),class:"px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700"}," Seleccionar ",8,At)])]))),128))])])])])):_("",!0),V.value&&a.value.length===0&&!y.value?(d(),u("div",Et,g[12]||(g[12]=[e("p",{class:"text-sm text-yellow-800"},"No se encontraron clientes. Intenta con otro documento o busca en RENIEC/SUNAT.",-1)]))):_("",!0),y.value?(d(),u("div",Pt,[e("h4",It,f(j.value?"✓ Datos encontrados en RENIEC/SUNAT":"Cliente no encontrado"),1),e("p",Dt,f(j.value?"Verifica los datos y completa la información:":"Complete los datos para crear un nuevo cliente:"),1),e("div",Vt,[r.value==="DNI"?(d(),u("div",jt,[g[13]||(g[13]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Nombres",-1)),N(e("input",{"onUpdate:modelValue":g[2]||(g[2]=v=>x.value.nombres=v),type:"text",placeholder:"Nombres",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm",required:""},null,512),[[R,x.value.nombres]])])):_("",!0),r.value==="DNI"?(d(),u("div",Mt,[g[14]||(g[14]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Apellidos",-1)),N(e("input",{"onUpdate:modelValue":g[3]||(g[3]=v=>x.value.apellidos=v),type:"text",placeholder:"Apellidos",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm",required:""},null,512),[[R,x.value.apellidos]])])):(d(),u("div",Tt,[g[15]||(g[15]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Razón Social",-1)),N(e("input",{"onUpdate:modelValue":g[4]||(g[4]=v=>x.value.razonSocial=v),type:"text",placeholder:"Razón Social",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm",required:""},null,512),[[R,x.value.razonSocial]])])),e("div",null,[g[16]||(g[16]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Email (opcional)",-1)),N(e("input",{"onUpdate:modelValue":g[5]||(g[5]=v=>x.value.correoElectronico=v),type:"email",placeholder:"correo@ejemplo.com",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm"},null,512),[[R,x.value.correoElectronico]])]),e("div",null,[g[17]||(g[17]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Teléfono (opcional)",-1)),N(e("input",{"onUpdate:modelValue":g[6]||(g[6]=v=>x.value.telefono=v),type:"tel",placeholder:"987654321",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm"},null,512),[[R,x.value.telefono]])]),e("button",{onClick:M,disabled:!P.value,class:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium"}," Crear y Seleccionar Cliente ",8,Nt)])])):_("",!0)])])])])])])):_("",!0)}},Bt={class:"right-to-left-money-input"},Ot=["for"],Ut={class:"input-container"},Lt=["id","value"],zt={key:1,class:"error-text"},qt={key:2,class:"help-text"},Ft={key:3,class:"instructions"},Ht={__name:"RightToLeftMoneyInput",props:{modelValue:{type:[Number,String],default:0},label:{type:String,default:"Monto (S/):"},helpText:{type:String,default:"Ingrese los dígitos de derecha a izquierda (centavos primero)"},showInstructions:{type:Boolean,default:!1},maxDigits:{type:Number,default:10},error:{type:String,default:""},id:{type:String,default:()=>`money-input-${Math.random().toString(36).substr(2,9)}`}},emits:["update:modelValue","change"],setup(t,{expose:l,emit:o}){const i=t,r=o,c=w(""),a=w("0.00"),y=w(null);Ue(()=>{i.modelValue&&T(i.modelValue)}),Y(()=>i.modelValue,C=>{C!==P()&&T(C)});const k=C=>{if(C===""){a.value="0.00",c.value="",V(0);return}C.length>i.maxDigits&&(C=C.substring(C.length-i.maxDigits));const I=C.slice(-2).padStart(2,"0"),M=C.slice(0,-2)||"0",$=M.replace(/\B(?=(\d{3})+(?!\d))/g,",");a.value=`${$}.${I}`,c.value=C,V(parseFloat(`${M}.${I}`))},V=C=>{r("update:modelValue",C),r("change",{value:C,formatted:a.value,raw:c.value})},j=C=>{const I=["Backspace","Delete","Tab","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"],M=/^[0-9]$/.test(C.key);if(!M&&!I.includes(C.key)){C.preventDefault();return}if(M){C.preventDefault();const $=c.value+C.key;k($)}if(C.key==="Backspace"){C.preventDefault();const $=c.value.slice(0,-1);k($)}},h=C=>{C.preventDefault();const M=C.clipboardData.getData("text").replace(/[^\d]/g,"");if(M){const $=c.value+M;k($)}},x=()=>{setTimeout(()=>{y.value&&(y.value.selectionStart=y.value.value.length,y.value.selectionEnd=y.value.value.length)},0)},P=()=>{if(c.value==="")return 0;const C=c.value.slice(-2).padStart(2,"0"),I=c.value.slice(0,-2)||"0";return parseFloat(`${I}.${C}`)},T=C=>{if(C==null){k("");return}const I=parseFloat(C).toFixed(2).replace(".","");k(I)};return l({getValue:P,setValue:T,reset:()=>{k("")},getFormattedValue:()=>a.value,getRawValue:()=>c.value}),(C,I)=>(d(),u("div",Bt,[t.label?(d(),u("label",{key:0,for:t.id,class:"input-label"},f(t.label),9,Ot)):_("",!0),e("div",Ut,[I[0]||(I[0]=e("span",{class:"currency-symbol"},"S/",-1)),e("input",{id:t.id,ref_key:"inputRef",ref:y,type:"text",value:a.value,placeholder:"0.00",readonly:"",onKeydown:j,onPaste:h,onFocus:x,onClick:x,class:G({"input-error":t.error})},null,42,Lt)]),t.error?(d(),u("p",zt,f(t.error),1)):t.helpText?(d(),u("p",qt,f(t.helpText),1)):_("",!0),t.showInstructions?(d(),u("div",Ft,I[1]||(I[1]=[e("h3",null,"Instrucciones:",-1),e("ul",null,[e("li",null,"Cada número que ingreses se añade a la izquierda"),e("li",null,"Los últimos dos dígitos siempre son centavos"),e("li",null,"Usa Backspace para borrar el último dígito ingresado"),e("li",null,"Máximo 8 dígitos enteros y 2 decimales")],-1)]))):_("",!0)]))}},Ie=Le(Ht,[["__scopeId","data-v-0a9d0f6d"]]),Qt={key:0,class:"fixed z-10 inset-0 overflow-y-auto"},Gt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Kt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Zt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Wt={class:"sm:flex sm:items-start"},Jt={class:"w-full"},Yt={class:"mb-4 p-3 bg-gray-50 rounded-lg"},Xt={class:"flex justify-between mb-2"},eo={class:"font-bold text-lg"},to={key:0,class:"flex justify-between mb-2 text-xs border-t border-dashed border-gray-300 pt-1"},oo={key:1,class:"flex justify-between mb-2"},so={class:"font-bold text-lg"},ao={class:"flex justify-between mb-2 border-t border-gray-300 pt-2"},lo={key:2,class:"text-sm text-gray-600"},no={class:"mb-4"},ro={class:"grid grid-cols-3 gap-3"},io={key:0,class:"mb-4 p-3 border rounded-lg"},uo={key:0,class:"mb-3"},co={key:0,class:"mb-3 p-2 bg-blue-50 border border-blue-200 rounded-lg"},mo={class:"grid grid-cols-3 gap-2"},po=["onClick"],vo={class:"font-medium"},go={key:1,class:"mt-2"},fo={key:0,class:"text-xs text-red-600 mb-1"},ho={key:1,class:"text-xs text-amber-600 mb-1"},yo={class:"mt-2 p-2 bg-gray-50 rounded border border-gray-200"},xo={class:"flex justify-between mb-1"},bo={key:0,class:"text-xs text-gray-600 mt-1"},wo={class:"flex flex-wrap gap-1"},ko={key:1,class:"mb-3"},Co={key:2,class:"mb-3"},_o={key:3,class:"mb-3"},$o={class:"flex flex-col gap-3 mt-6"},So=["disabled"],Ao={key:1,class:"fixed z-20 inset-0 overflow-y-auto"},Eo={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Po={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full"},Io={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Do={class:"sm:flex sm:items-start"},Vo={class:"w-full"},jo={class:"mb-4 p-4 border rounded-lg bg-gray-50 font-mono text-sm"},Mo={class:"text-center mb-3"},To={class:"mt-2 font-bold"},No={key:0,class:"mb-3"},Ro={class:"mb-3"},Bo={class:"w-1/2 truncate"},Oo={class:"w-1/6 text-right"},Uo={class:"w-1/6 text-right"},Lo={class:"w-1/6 text-right"},zo={class:"border-t border-gray-300 pt-1"},qo={class:"flex justify-between"},Fo={class:"flex justify-between"},Ho={class:"flex justify-between font-bold"},Qo={key:0,class:"flex justify-between text-xs mt-1 border-t border-dashed border-gray-300 pt-1"},Go={key:1,class:"flex justify-between font-bold text-sm border-t border-gray-300 pt-1 mt-1"},Ko={class:"mt-2"},Zo={key:0,class:"text-xs ml-1"},Wo={class:"mt-2 pt-1 border-t border-gray-300"},Jo={class:"flex justify-between"},Yo={class:"font-bold"},Xo={key:0,class:"flex justify-between"},es={class:"font-bold text-green-600"},ts={class:"mt-4"},os={class:"mb-3"},ss={key:1,class:"border rounded-lg p-3 bg-gray-50"},as={class:"flex justify-between items-center mb-2"},ls={class:"mb-2"},ns=["disabled"],rs={key:1,class:"border rounded-lg p-3 bg-gray-50"},is={class:"flex justify-between items-center mb-2"},us={class:"mb-2"},ds=["disabled"],cs={__name:"PaymentModal",props:{modelValue:{type:Boolean,required:!0},total:{type:Number,required:!0},customer:{type:Object,default:null},items:{type:Array,required:!0},payments:{type:Array,required:!0},documentType:{type:String,default:"boleta"},remainingAmount:{type:Number,required:!0},showTicket:{type:Boolean,default:!1}},emits:["update:modelValue","payment-added","sale-finalized","update:show-ticket"],setup(t,{emit:l}){const o=t,i=l,r=w(""),c=w(0),a=w(0),y=w(0),k=w(""),V=w(""),j=w(""),h=w(o.showTicket),x=w(!1),P=w(""),T=w(!1),O=w(""),C=w([]),I=w(null),M=w(null),$=H(()=>!(!r.value||r.value==="efectivo"&&a.value<=0||r.value!=="efectivo"&&c.value<=0||r.value==="efectivo"&&I.value&&I.value.errors.length>0||r.value==="tarjeta"&&!k.value||r.value==="giftcard"&&!V.value)),S=H(()=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(P.value)),E=H(()=>/^\+51 \d{3} \d{3} \d{3}$/.test(O.value)),g=A=>{r.value=A,c.value=0,a.value=0,y.value=0,j.value="",k.value="",V.value="",I.value=null,M.value=null,A==="efectivo"?(C.value=rt(o.remainingAmount),console.log("💡 [PaymentModal] Sugerencias de pago generadas:",C.value)):C.value=[]},v=()=>{const A=we(a.value);Math.abs(a.value-A)>.001&&(a.value=A),c.value=o.remainingAmount;const s=a.value-o.remainingAmount;y.value=Math.max(0,we(s)),I.value=lt(a.value,o.remainingAmount),y.value>0?(M.value=nt(y.value),console.log("💵 [PaymentModal] Desglose del vuelto:",M.value)):M.value=null},D=A=>{console.log("✨ [PaymentModal] Aplicando sugerencia:",A),a.value=A.amount},X=A=>A>=1?`S/ ${A}`:`S/ ${A.toFixed(2)}`,J=A=>({efectivo:"Efectivo",tarjeta:"Tarjeta de crédito/débito",qr:"Pago con QR",credito:"Crédito",giftcard:"Gift Card",puntos:"Puntos"})[A]||"",Ce=()=>{let A="",s=0,b=0;switch(r.value){case"efectivo":s=o.remainingAmount,A=`Cambio: ${U(y.value)}`;const ae=o.total,he=we(ae);if(b=we(he-ae),console.log("💰 [PaymentModal] Calculando redondeo:",{totalOriginal:ae,totalRedondeado:he,redondeo:b}),M.value&&M.value.breakdown.length>0){const Ae=M.value.breakdown.map(ye=>`${ye.count}x${X(ye.value)}`).join(", ");A+=` (${Ae})`}break;case"tarjeta":s=Math.min(c.value,o.remainingAmount),A=`Auth: ${k.value}`;break;case"qr":s=Math.min(c.value,o.remainingAmount),A="QR";break;case"giftcard":s=Math.min(c.value,o.remainingAmount),A=`GC: ${V.value}`;break;default:s=Math.min(c.value,o.remainingAmount),A=""}console.log("💳 [PaymentModal] Agregando pago:",{method:r.value,amount:s,reference:A,roundingAmount:b});const L={method:r.value,methodName:J(r.value),amount:s,reference:A};r.value==="efectivo"&&b!==0&&(L.roundingAmount=b),i("payment-added",L),oe()},oe=()=>{i("update:modelValue",!1),re()},ve=()=>{h.value=!1,i("update:show-ticket",!1)},re=()=>{r.value="",c.value=0,a.value=0,y.value=0,k.value="",V.value="",j.value="",h.value=!1,x.value=!1,P.value="",T.value=!1,O.value="",C.value=[],I.value=null,M.value=null},_e=H(()=>o.payments.reduce((A,s)=>A+s.amount,0)),se=H(()=>{const A=o.payments.filter(b=>b.method==="efectivo");let s=0;return A.forEach(b=>{var ae;const L=(ae=b.reference)==null?void 0:ae.match(/Cambio: S\/\s*([\d.]+)/);L&&(s+=parseFloat(L[1]))}),Math.round(s*100)/100}),K=H(()=>{const A=o.payments.find(s=>s.method==="efectivo");return(A==null?void 0:A.roundingAmount)||0}),W=()=>{window.print()},$e=()=>{i("sale-finalized"),oe()},Se=()=>{S.value&&(console.log(`Enviando ticket por email a: ${P.value}`),alert(`Ticket enviado por email a ${P.value}`),x.value=!1,P.value="")},fe=()=>{if(!E.value)return;console.log(`Enviando ticket por WhatsApp al número: ${O.value}`);const A=encodeURIComponent(`Ticket de compra - Total: ${U(o.total)}`),s=`https://wa.me/${O.value.replace(/\s+/g,"")}?text=${A}`;window.open(s,"_blank"),T.value=!1,O.value=""},U=A=>`S/ ${A.toFixed(2)}`;return Y(()=>o.showTicket,A=>{A&&(h.value=!0)}),Y(h,A=>{i("update:show-ticket",A)}),Y(a,()=>{r.value==="efectivo"&&v()}),Y(()=>o.modelValue,A=>{A&&re()}),(A,s)=>(d(),u(Q,null,[t.modelValue?(d(),u("div",Qt,[e("div",Gt,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:oe}),e("div",Kt,[e("div",Zt,[e("div",Wt,[e("div",Jt,[e("div",{class:"flex justify-between items-center mb-4"},[s[19]||(s[19]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Añadir Pago",-1)),e("button",{onClick:oe,class:"text-gray-400 hover:text-gray-500 focus:outline-none"},s[18]||(s[18]=[e("svg",{class:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Yt,[e("div",Xt,[s[20]||(s[20]=e("span",{class:"font-medium"},"Total:",-1)),e("span",eo,f(U(t.total)),1)]),K.value!==0?(d(),u("div",to,[e("span",null,f(K.value>0?"Redondeo (+):":"Redondeo (-):"),1),e("span",{class:G(K.value>0?"text-red-600":"text-green-600")},f(U(Math.abs(K.value))),3)])):_("",!0),K.value!==0?(d(),u("div",oo,[s[21]||(s[21]=e("span",{class:"font-medium text-sm"},"Total a pagar:",-1)),e("span",so,f(U(t.total+K.value)),1)])):_("",!0),e("div",ao,[s[22]||(s[22]=e("span",{class:"font-medium"},"Saldo pendiente:",-1)),e("span",{class:G(["font-bold text-lg",t.remainingAmount===0?"text-green-600":"text-red-600"])},f(U(t.remainingAmount)),3)]),t.customer?(d(),u("div",lo," Cliente: "+f(t.customer.name),1)):_("",!0)]),e("div",no,[s[29]||(s[29]=e("div",{class:"font-medium mb-2"},"Método de pago:",-1)),e("div",ro,[e("button",{onClick:s[0]||(s[0]=b=>g("efectivo")),class:G(["btn flex items-center justify-center py-3 rounded-lg transition-colors duration-200",r.value==="efectivo"?"bg-green-600 text-white":"bg-green-100 hover:bg-green-200 text-green-800"])},s[23]||(s[23]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2"}),e("circle",{cx:"12",cy:"12",r:"2"}),e("path",{d:"M6 12h.01M18 12h.01"})],-1),q(" Efectivo ")]),2),e("button",{onClick:s[1]||(s[1]=b=>g("tarjeta")),class:G(["btn flex items-center justify-center py-3 rounded-lg transition-colors duration-200",r.value==="tarjeta"?"bg-blue-600 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-800"])},s[24]||(s[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),e("line",{x1:"1",y1:"10",x2:"23",y2:"10"})],-1),q(" Tarjeta ")]),2),e("button",{onClick:s[2]||(s[2]=b=>g("qr")),class:G(["btn flex items-center justify-center py-3 rounded-lg transition-colors duration-200",r.value==="qr"?"bg-purple-600 text-white":"bg-purple-100 hover:bg-purple-200 text-purple-800"])},s[25]||(s[25]=[te('<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><rect x="7" y="7" width="3" height="3"></rect><rect x="14" y="7" width="3" height="3"></rect><rect x="7" y="14" width="3" height="3"></rect><rect x="14" y="14" width="3" height="3"></rect></svg> QR ',2)]),2),e("button",{onClick:s[3]||(s[3]=b=>g("credito")),class:G(["btn flex items-center justify-center py-3 rounded-lg transition-colors duration-200",r.value==="credito"?"bg-yellow-600 text-white":"bg-yellow-100 hover:bg-yellow-200 text-yellow-800"])},s[26]||(s[26]=[te('<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"></path><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"></path><path d="M7 21h10"></path><path d="M12 3v18"></path><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"></path></svg> Crédito ',2)]),2),e("button",{onClick:s[4]||(s[4]=b=>g("giftcard")),class:G(["btn flex items-center justify-center py-3 rounded-lg transition-colors duration-200",r.value==="giftcard"?"bg-pink-600 text-white":"bg-pink-100 hover:bg-pink-200 text-pink-800"])},s[27]||(s[27]=[te('<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="8" width="18" height="4" rx="1"></rect><path d="M12 8v13"></path><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"></path><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"></path></svg> Gift Card ',2)]),2),e("button",{onClick:s[5]||(s[5]=b=>g("puntos")),class:G(["btn flex items-center justify-center py-3 rounded-lg transition-colors duration-200",r.value==="puntos"?"bg-orange-600 text-white":"bg-orange-100 hover:bg-orange-200 text-orange-800"])},s[28]||(s[28]=[te('<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg> Puntos ',2)]),2)])]),r.value?(d(),u("div",io,[r.value==="efectivo"?(d(),u("div",uo,[C.value.length>0?(d(),u("div",co,[s[30]||(s[30]=te('<div class="text-xs font-medium text-blue-900 mb-2 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg> Montos sugeridos (minimiza vuelto): </div>',1)),e("div",mo,[(d(!0),u(Q,null,Z(C.value.slice(0,6),(b,L)=>(d(),u("button",{key:L,onClick:ae=>D(b),class:G(["px-2 py-1 text-xs rounded transition-colors",b.optimal?"bg-green-100 hover:bg-green-200 border border-green-400 text-green-900 font-medium":"bg-white hover:bg-gray-100 border border-gray-300 text-gray-700"]),type:"button"},[e("div",vo,"S/ "+f(b.amount.toFixed(2)),1),e("div",{class:G(["text-[10px] leading-tight",b.optimal?"text-green-700":"text-gray-500"])},f(b.change===0?"Exacto":`Vuelto: ${b.change.toFixed(2)}`),3)],10,po))),128))])])):_("",!0),ne(Ie,{modelValue:a.value,"onUpdate:modelValue":s[6]||(s[6]=b=>a.value=b),label:"Monto Entregado",helpText:"Ingrese el monto entregado por el cliente"},null,8,["modelValue"]),I.value&&a.value>0?(d(),u("div",go,[I.value.errors.length>0?(d(),u("div",fo,[(d(!0),u(Q,null,Z(I.value.errors,(b,L)=>(d(),u("div",{key:L,class:"flex items-start"},[s[31]||(s[31]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1 mt-0.5 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})],-1)),q(" "+f(b),1)]))),128))])):_("",!0),I.value.warnings.length>0?(d(),u("div",ho,[(d(!0),u(Q,null,Z(I.value.warnings,(b,L)=>(d(),u("div",{key:L,class:"flex items-start"},[s[32]||(s[32]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3 mr-1 mt-0.5 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})],-1)),q(" "+f(b),1)]))),128))])):_("",!0)])):_("",!0),e("div",yo,[e("div",xo,[s[33]||(s[33]=e("span",{class:"text-sm font-medium"},"Cambio:",-1)),e("span",{class:G(["text-sm font-bold",y.value>=0?"text-green-600":"text-red-600"])},f(U(y.value)),3)]),M.value&&M.value.breakdown.length>0?(d(),u("div",bo,[s[34]||(s[34]=e("div",{class:"font-medium mb-1"},"Desglose del vuelto:",-1)),e("div",wo,[(d(!0),u(Q,null,Z(M.value.breakdown,(b,L)=>(d(),u("span",{key:L,class:"px-1.5 py-0.5 bg-white border border-gray-300 rounded text-[10px]"},f(b.count)+"x "+f(X(b.value)),1))),128))])])):_("",!0)])])):_("",!0),r.value==="tarjeta"?(d(),u("div",ko,[ne(Ie,{modelValue:c.value,"onUpdate:modelValue":s[7]||(s[7]=b=>c.value=b),label:"Monto cargado",helpText:"Ingrese el monto cargado por la tarjeta"},null,8,["modelValue"]),s[35]||(s[35]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 mt-2"},"Código de autorización",-1)),N(e("input",{type:"text","onUpdate:modelValue":s[8]||(s[8]=b=>k.value=b),class:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[R,k.value]])])):_("",!0),r.value==="qr"?(d(),u("div",Co,[ne(Ie,{modelValue:c.value,"onUpdate:modelValue":s[9]||(s[9]=b=>c.value=b),label:"Monto pagado",helpText:"Ingrese el monto pagado por el cliente"},null,8,["modelValue"]),s[36]||(s[36]=te('<div class="text-center mt-3"><div class="mb-2 font-medium">Escanea para pagar</div><div class="flex justify-center mb-3"><img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&amp;data=POS2-Payment" alt="QR Code" class="border p-2 rounded-lg"></div><div class="text-sm text-gray-600"> Este es un QR ficticio para demostración </div></div>',1))])):_("",!0),r.value==="giftcard"?(d(),u("div",_o,[s[37]||(s[37]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Monto a cargar",-1)),N(e("input",{type:"number","onUpdate:modelValue":s[10]||(s[10]=b=>c.value=b),class:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",step:"0.01"},null,512),[[R,c.value]]),s[38]||(s[38]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1 mt-2"},"Código de Gift Card",-1)),N(e("input",{type:"text","onUpdate:modelValue":s[11]||(s[11]=b=>V.value=b),class:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[R,V.value]])])):_("",!0)])):_("",!0),e("div",$o,[r.value?(d(),u("button",{key:0,onClick:Ce,class:G(["btn py-3 px-4 rounded-lg transition-colors duration-200 flex items-center justify-center",$.value?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"]),disabled:!$.value},s[39]||(s[39]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M12 5v14M5 12h14"})],-1),q(" Añadir Pago ")]),10,So)):_("",!0),e("button",{onClick:oe,class:"btn py-3 px-4 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-700 transition-colors duration-200 flex items-center justify-center"}," Cancelar ")])])])])])])])):_("",!0),h.value?(d(),u("div",Ao,[e("div",Eo,[s[65]||(s[65]=e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)),e("div",Po,[e("div",Io,[e("div",Do,[e("div",Vo,[e("div",{class:"flex justify-between items-center mb-4"},[s[41]||(s[41]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Pago Completado",-1)),e("button",{onClick:ve,class:"text-gray-400 hover:text-gray-500 focus:outline-none"},s[40]||(s[40]=[e("svg",{class:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",jo,[e("div",Mo,[s[42]||(s[42]=e("div",{class:"font-bold"},"EMPRESA EJEMPLO S.A.C.",-1)),s[43]||(s[43]=e("div",null,"RUC: 20123456789",-1)),s[44]||(s[44]=e("div",null,"Av. Ejemplo 123, Lima",-1)),s[45]||(s[45]=e("div",null,"Tel: 01-123-4567",-1)),e("div",To,f(o.documentType==="boleta"?"BOLETA DE VENTA ELECTRÓNICA":"FACTURA ELECTRÓNICA"),1),e("div",null,f(o.documentType==="boleta"?"B001-00001234":"F001-00001234"),1),e("div",null,"Fecha: "+f(new Date().toLocaleDateString()),1)]),o.customer?(d(),u("div",No,[e("div",null,"Cliente: "+f(o.customer.razonSocial||`${o.customer.nombres} ${o.customer.apellidos}`),1),e("div",null,f(o.customer.tipoDoc)+": "+f(o.customer.numDoc),1)])):_("",!0),e("div",Ro,[s[46]||(s[46]=te('<div class="border-b border-gray-300 pb-1 mb-1 font-bold flex"><span class="w-1/2">Producto</span><span class="w-1/6 text-right">Cant.</span><span class="w-1/6 text-right">P.Unit</span><span class="w-1/6 text-right">Total</span></div>',1)),(d(!0),u(Q,null,Z(o.items,(b,L)=>(d(),u("div",{key:L,class:"flex text-xs py-1"},[e("span",Bo,f(b.nombre),1),e("span",Oo,f(b.quantity),1),e("span",Uo,f(U(b.precio)),1),e("span",Lo,f(U(b.precio*b.quantity)),1)]))),128))]),e("div",zo,[e("div",qo,[s[47]||(s[47]=e("span",null,"Subtotal:",-1)),e("span",null,f(U(o.total*.82)),1)]),e("div",Fo,[s[48]||(s[48]=e("span",null,"IGV (18%):",-1)),e("span",null,f(U(o.total*.18)),1)]),e("div",Ho,[s[49]||(s[49]=e("span",null,"Total:",-1)),e("span",null,f(U(o.total)),1)]),K.value!==0?(d(),u("div",Qo,[e("span",null,f(K.value>0?"Redondeo (+):":"Redondeo (-):"),1),e("span",{class:G(K.value>0?"text-red-600":"text-green-600")},f(U(Math.abs(K.value))),3)])):_("",!0),K.value!==0?(d(),u("div",Go,[s[50]||(s[50]=e("span",null,"Total a Pagar:",-1)),e("span",null,f(U(o.total+K.value)),1)])):_("",!0),e("div",Ko,[s[53]||(s[53]=e("div",null,"Forma de pago:",-1)),(d(!0),u(Q,null,Z(o.payments,(b,L)=>(d(),u("div",{key:L},[q(f(J(b.method))+": "+f(U(b.amount))+" ",1),b.reference?(d(),u("span",Zo,"(Ref: "+f(b.reference)+")",1)):_("",!0)]))),128)),e("div",Wo,[e("div",Jo,[s[51]||(s[51]=e("span",null,"Total pagado:",-1)),e("span",Yo,f(U(_e.value)),1)]),se.value>0?(d(),u("div",Xo,[s[52]||(s[52]=e("span",null,"Cambio:",-1)),e("span",es,f(U(se.value)),1)])):_("",!0)])])]),s[54]||(s[54]=e("div",{class:"text-center mt-3 text-xs"},[e("div",null,"¡Gracias por su compra!"),e("div",null,"Visite nuestra página web: www.ejemplo.com")],-1))]),e("div",{class:"flex justify-between mt-6"},[e("button",{class:"py-4 px-6 rounded-lg text-lg font-medium transition-all duration-200 bg-blue-600 hover:bg-blue-700 text-white shadow-lg hover:shadow-xl transform hover:-translate-y-1",onClick:W},s[55]||(s[55]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 inline",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"6 9 6 2 18 2 18 9"}),e("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),e("rect",{x:"6",y:"14",width:"12",height:"8"})],-1),q(" Imprimir ")])),e("button",{class:"py-4 px-6 rounded-lg text-lg font-medium transition-all duration-200 bg-green-600 hover:bg-green-700 text-white shadow-lg hover:shadow-xl transform hover:-translate-y-1",onClick:$e},s[56]||(s[56]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 inline",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e("polyline",{points:"22 4 12 14.01 9 11.01"})],-1),q(" Finalizar ")]))]),e("div",ts,[e("div",os,[x.value?_("",!0):(d(),u("button",{key:0,class:"w-full py-2 px-4 rounded-lg text-sm font-medium transition-all duration-200 bg-red-600 hover:bg-red-700 text-white shadow-md hover:shadow-lg",onClick:s[12]||(s[12]=b=>x.value=!0)},s[57]||(s[57]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2 inline",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),e("polyline",{points:"22,6 12,13 2,6"})],-1),q(" Enviar por Email ")]))),x.value?(d(),u("div",ss,[e("div",as,[s[59]||(s[59]=e("h4",{class:"font-medium"},"Enviar por Email",-1)),e("button",{onClick:s[13]||(s[13]=b=>x.value=!1),class:"text-gray-400 hover:text-gray-500 focus:outline-none"},s[58]||(s[58]=[e("svg",{class:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",ls,[s[60]||(s[60]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),N(e("input",{type:"email","onUpdate:modelValue":s[14]||(s[14]=b=>P.value=b),class:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ejemplo@correo.com"},null,512),[[R,P.value]])]),e("button",{class:G(["w-full py-2 px-4 rounded-lg text-sm font-medium transition-all duration-200 bg-red-600 hover:bg-red-700 text-white",S.value?"":"opacity-50 cursor-not-allowed"]),onClick:Se,disabled:!S.value}," Enviar ",10,ns)])):_("",!0)]),e("div",null,[T.value?_("",!0):(d(),u("button",{key:0,class:"w-full py-2 px-4 rounded-lg text-sm font-medium transition-all duration-200 bg-green-500 hover:bg-green-600 text-white shadow-md hover:shadow-lg",onClick:s[15]||(s[15]=b=>T.value=!0)},s[61]||(s[61]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2 inline",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M3 21l1.65-3.8a9 9 0 1 1 3.4 2.9L3 21"}),e("path",{d:"M9 10a.5.5 0 0 0 1 0V9a.5.5 0 0 0-1 0v1zm0 0a5 5 0 0 0 5 5h1a.5.5 0 0 0 0-1h-1a.5.5 0 0 0 0 1"})],-1),q(" Enviar por WhatsApp ")]))),T.value?(d(),u("div",rs,[e("div",is,[s[63]||(s[63]=e("h4",{class:"font-medium"},"Enviar por WhatsApp",-1)),e("button",{onClick:s[16]||(s[16]=b=>T.value=!1),class:"text-gray-400 hover:text-gray-500 focus:outline-none"},s[62]||(s[62]=[e("svg",{class:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",us,[s[64]||(s[64]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Número de teléfono",-1)),N(e("input",{type:"tel","onUpdate:modelValue":s[17]||(s[17]=b=>O.value=b),class:"w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"+51 999 999 999"},null,512),[[R,O.value]])]),e("button",{class:G(["w-full py-2 px-4 rounded-lg text-sm font-medium transition-all duration-200 bg-green-500 hover:bg-green-600 text-white",E.value?"":"opacity-50 cursor-not-allowed"]),onClick:fe,disabled:!E.value}," Enviar ",10,ds)])):_("",!0)])])])])])])])])):_("",!0)],64))}},ms={key:0,class:"fixed z-10 inset-0 overflow-y-auto"},ps={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},vs={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},gs={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},fs={class:"sm:flex sm:items-start"},hs={class:"w-full"},ys={key:0,class:"overflow-x-auto"},xs={class:"min-w-full divide-y divide-gray-200 table-fixed"},bs={class:"bg-white divide-y divide-gray-200"},ws={class:"px-6 py-4 whitespace-nowrap text-sm"},ks={class:"px-6 py-4 text-sm truncate max-w-xs"},Cs={class:"px-6 py-4 text-sm"},_s={class:"px-6 py-4 whitespace-nowrap text-sm"},$s={class:"px-6 py-4 whitespace-nowrap text-sm"},Ss={class:"flex space-x-2"},As=["onClick"],Es=["onClick"],Ps={key:1,class:"text-center py-8"},Is={__name:"SavedSalesModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue","resume-sale"],setup(t,{emit:l}){const o=t,i=l,r=ze(),c=w([]);Y(()=>o.modelValue,x=>{x&&(c.value=r.getSavedSales())}),c.value=r.getSavedSales();function a(x){return x?new Date(x).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}function y(x){return isNaN(x)||x===null||x===void 0?"S/ 0.00":new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(x)}function k(x){return x?x.name||"Cliente sin nombre":"Sin cliente"}function V(x){i("resume-sale",x),h()}async function j(x){if(confirm("¿Está seguro de eliminar esta venta guardada?"))try{r.deleteSavedSale(x),c.value=r.getSavedSales()}catch(P){console.error("Error al eliminar la venta guardada:",P),alert("Ocurrió un error al eliminar la venta guardada")}}function h(){i("update:modelValue",!1)}return(x,P)=>t.modelValue?(d(),u("div",ms,[e("div",ps,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:h}),e("div",vs,[e("div",gs,[e("div",fs,[e("div",hs,[e("div",{class:"flex justify-between items-center mb-4"},[P[1]||(P[1]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Ventas Guardadas",-1)),e("button",{onClick:h,class:"text-gray-400 hover:text-gray-500 focus:outline-none"},P[0]||(P[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M6 18L18 6M6 6l12 12"})],-1)]))]),c.value.length>0?(d(),u("div",ys,[e("table",xs,[P[4]||(P[4]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/6"},"Fecha"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/6"},"Cliente"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/6"},"Productos"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/6"},"Total"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/6"},"Acciones")])],-1)),e("tbody",bs,[(d(!0),u(Q,null,Z(c.value,T=>(d(),u("tr",{key:T.id},[e("td",ws,f(a(T.timestamp)),1),e("td",ks,f(T.customer?k(T.customer):"Sin cliente"),1),e("td",Cs,f(T.items.length)+" productos",1),e("td",_s,f(y(T.total)),1),e("td",$s,[e("div",Ss,[e("button",{onClick:O=>V(T),class:"text-indigo-600 hover:text-indigo-900 flex items-center"},P[2]||(P[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polygon",{points:"5 3 19 12 5 21 5 3"})],-1),q(" Retomar ")]),8,As),e("button",{onClick:O=>j(T.id),class:"text-red-600 hover:text-red-900 flex items-center"},P[3]||(P[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M3 6h18"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1),q(" Eliminar ")]),8,Es)])])]))),128))])])])):(d(),u("div",Ps,P[5]||(P[5]=[te('<svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg><p class="text-gray-500">No hay ventas guardadas</p>',2)])))])])]),e("div",{class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},[e("button",{type:"button",onClick:h,class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cerrar ")])])])])):_("",!0)}},Ds={key:0,class:"fixed z-10 inset-0 overflow-y-auto"},Vs={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},js={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Ms={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ts={class:"sm:flex sm:items-start"},Ns={class:"w-full"},Rs={class:"mb-4"},Bs={class:"flex gap-2 items-center"},Os=["placeholder","maxlength"],Us=["disabled"],Ls={key:0,class:"mb-4 p-4 border rounded-lg bg-green-50"},zs={class:"flex items-start justify-between"},qs={class:"text-sm font-medium text-gray-900"},Fs={class:"text-xs text-gray-600"},Hs={key:0,class:"text-xs text-gray-600"},Qs={key:1,class:"text-xs text-gray-600"},Gs={key:1,class:"mb-4 p-4 border rounded-lg bg-yellow-50"},Ks={class:"space-y-2"},Zs={class:"grid grid-cols-3 gap-2"},Ws=["disabled"],Js={class:"flex gap-2 mt-4"},Ys={__name:"StartSaleModal",props:{modelValue:Boolean},emits:["update:modelValue","start"],setup(t,{emit:l}){const o=t,i=l,r=w("DNI"),c=w(""),a=w(null),y=w(!1),k=w(!1),V=w(null),j=w(null),h=w({nombres:"",apellidos:"",razonSocial:"",correoElectronico:"",telefono:"",direccion:"",departamento:"",provincia:"",distrito:""});Y(()=>o.modelValue,g=>{g&&le(()=>{var v;(v=V.value)==null||v.focus()})});const x=H(()=>r.value==="DNI"?h.value.nombres&&h.value.apellidos:h.value.razonSocial),P=()=>{c.value="",a.value=null,k.value=!1},T=()=>{c.value=c.value.replace(/\D/g,""),a.value=null,k.value=!1},O=async()=>{if(!c.value)return;const g=r.value==="DNI"?8:11;if(c.value.length!==g){alert(`El ${r.value} debe tener ${g} dígitos`);return}y.value=!0,j.value=null;try{const v=r.value==="DNI"?"1":"6",D=await pe.searchByDocument(c.value,v);if(D.success&&D.found)a.value=D.data,k.value=!1;else{const X=await pe.lookupDocument(c.value,r.value.toLowerCase());X.success?(j.value=X.data,a.value=null,k.value=!0,r.value==="DNI"?(h.value.nombres=j.value.nombres||"",h.value.apellidos=`${j.value.apellidoPaterno||""} ${j.value.apellidoMaterno||""}`.trim(),h.value.razonSocial="",h.value.direccion="",h.value.departamento="",h.value.provincia="",h.value.distrito=""):(h.value.razonSocial=j.value.razonSocial||"",h.value.direccion=j.value.direccion||"",h.value.departamento=j.value.departamento||"",h.value.provincia=j.value.provincia||"",h.value.distrito=j.value.distrito||"",h.value.nombres="",h.value.apellidos=""),h.value.correoElectronico="",h.value.telefono=""):(a.value=null,k.value=!0,h.value.nombres="",h.value.apellidos="",h.value.razonSocial="",h.value.correoElectronico="",h.value.telefono="",h.value.direccion="",h.value.departamento="",h.value.provincia="",h.value.distrito="")}}catch(v){console.error("Error searching customer:",v),alert("Error al buscar el cliente")}finally{y.value=!1}},C=async()=>{try{const g={nombres:h.value.nombres,apellidos:h.value.apellidos,razonSocial:h.value.razonSocial,email:h.value.correoElectronico,telefono:h.value.telefono,numeroDocumento:c.value,tipoDocumento:r.value==="DNI"?"1":"6",direccion:h.value.direccion,departamento:h.value.departamento,provincia:h.value.provincia,distrito:h.value.distrito},v=await pe.createCustomer(g);v.success?(a.value=v.data,k.value=!1,M()):alert(v.error||"Error al crear el cliente")}catch(g){console.error("Error creating customer:",g),alert("Error al crear el cliente")}},I=()=>{a.value=null,c.value="",k.value=!1},M=()=>{i("start",{customer:a.value}),S()},$=()=>{i("start",{customer:null}),S()},S=()=>{i("update:modelValue",!1),E()},E=()=>{c.value="",a.value=null,k.value=!1,y.value=!1,h.value={nombres:"",apellidos:"",razonSocial:"",correoElectronico:"",telefono:"",direccion:"",departamento:"",provincia:"",distrito:""}};return(g,v)=>t.modelValue?(d(),u("div",Ds,[e("div",Vs,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:S}),e("div",js,[e("div",Ms,[e("div",Ts,[e("div",Ns,[e("div",{class:"flex justify-between items-center mb-4"},[v[12]||(v[12]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Iniciar Nueva Venta",-1)),e("button",{onClick:S,class:"text-gray-400 hover:text-gray-500 focus:outline-none"},v[11]||(v[11]=[e("svg",{class:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Rs,[v[14]||(v[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Información del Cliente (Opcional) ",-1)),e("div",Bs,[N(e("select",{"onUpdate:modelValue":v[0]||(v[0]=D=>r.value=D),class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-1/4",onChange:P},v[13]||(v[13]=[e("option",{value:"DNI"},"DNI",-1),e("option",{value:"RUC"},"RUC",-1)]),544),[[De,r.value]]),N(e("input",{ref_key:"docInput",ref:V,"onUpdate:modelValue":v[1]||(v[1]=D=>c.value=D),type:"text",placeholder:r.value==="DNI"?"8 dígitos":"11 dígitos",maxlength:r.value==="DNI"?8:11,class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 flex-1",onInput:T,onKeyup:Ve(O,["enter"])},null,40,Os),[[R,c.value]]),c.value?(d(),u("button",{key:0,onClick:O,disabled:y.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"},f(y.value?"Buscando...":"Buscar"),9,Us)):_("",!0)]),v[15]||(v[15]=e("p",{class:"text-xs text-gray-500 mt-1"},' Ingrese el documento del cliente o haga clic en "Omitir" para continuar sin cliente ',-1))]),a.value?(d(),u("div",Ls,[e("div",zs,[e("div",null,[e("p",qs,f(a.value.name||a.value.razonSocial||`${a.value.nombres||""} ${a.value.apellidos||""}`.trim()||"Cliente"),1),e("p",Fs,f(a.value.document_type==="1"?"DNI":a.value.document_type==="6"?"RUC":a.value.tipoDoc)+": "+f(a.value.document_number||a.value.numDoc),1),a.value.email||a.value.correoElectronico?(d(),u("p",Hs,f(a.value.email||a.value.correoElectronico),1)):_("",!0),a.value.phone||a.value.telefono?(d(),u("p",Qs,f(a.value.phone||a.value.telefono),1)):_("",!0)]),e("button",{onClick:I,class:"text-gray-400 hover:text-gray-600"},v[16]||(v[16]=[e("svg",{class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):_("",!0),k.value?(d(),u("div",Gs,[v[17]||(v[17]=e("h4",{class:"text-sm font-medium text-gray-800 mb-2"},"Cliente no encontrado",-1)),v[18]||(v[18]=e("p",{class:"text-xs text-gray-600 mb-3"},"Complete los datos para crear un nuevo cliente:",-1)),e("div",Ks,[r.value==="DNI"?(d(),u(Q,{key:0},[N(e("input",{"onUpdate:modelValue":v[2]||(v[2]=D=>h.value.nombres=D),type:"text",placeholder:"Nombres",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm",required:""},null,512),[[R,h.value.nombres]]),N(e("input",{"onUpdate:modelValue":v[3]||(v[3]=D=>h.value.apellidos=D),type:"text",placeholder:"Apellidos",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm",required:""},null,512),[[R,h.value.apellidos]])],64)):(d(),u(Q,{key:1},[N(e("input",{"onUpdate:modelValue":v[4]||(v[4]=D=>h.value.razonSocial=D),type:"text",placeholder:"Razón Social",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm",required:""},null,512),[[R,h.value.razonSocial]]),N(e("input",{"onUpdate:modelValue":v[5]||(v[5]=D=>h.value.direccion=D),type:"text",placeholder:"Dirección",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm"},null,512),[[R,h.value.direccion]]),e("div",Zs,[N(e("input",{"onUpdate:modelValue":v[6]||(v[6]=D=>h.value.departamento=D),type:"text",placeholder:"Departamento",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm"},null,512),[[R,h.value.departamento]]),N(e("input",{"onUpdate:modelValue":v[7]||(v[7]=D=>h.value.provincia=D),type:"text",placeholder:"Provincia",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm"},null,512),[[R,h.value.provincia]]),N(e("input",{"onUpdate:modelValue":v[8]||(v[8]=D=>h.value.distrito=D),type:"text",placeholder:"Distrito",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm"},null,512),[[R,h.value.distrito]])])],64)),N(e("input",{"onUpdate:modelValue":v[9]||(v[9]=D=>h.value.correoElectronico=D),type:"email",placeholder:"Correo electrónico (opcional)",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm"},null,512),[[R,h.value.correoElectronico]]),N(e("input",{"onUpdate:modelValue":v[10]||(v[10]=D=>h.value.telefono=D),type:"tel",placeholder:"Teléfono (opcional)",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 w-full text-sm"},null,512),[[R,h.value.telefono]]),e("button",{onClick:C,disabled:!x.value,class:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm"}," Crear y Continuar ",8,Ws)])])):_("",!0),e("div",Js,[e("button",{onClick:$,class:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"}," Omitir "),a.value?(d(),u("button",{key:0,onClick:M,class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," Iniciar Venta ")):_("",!0)])])])])])])])):_("",!0)}},Xs="https://api.apis.net.pe/";class ea{constructor(){this.baseURL=`${Xs}/api/v1/employees`}getToken(){return localStorage.getItem("token")}getHeaders(){const l=this.getToken();return{"Content-Type":"application/json",Authorization:l?`Bearer ${l}`:""}}async getEmployees(l=!0){try{return(await ue.get(this.baseURL,{headers:this.getHeaders(),params:{active_only:l?"1":"0"}})).data}catch(o){throw console.error("Error fetching employees:",o),o}}async getEmployee(l){try{return(await ue.get(`${this.baseURL}/${l}`,{headers:this.getHeaders()})).data}catch(o){throw console.error("Error fetching employee:",o),o}}async createEmployee(l){try{return(await ue.post(this.baseURL,l,{headers:this.getHeaders()})).data}catch(o){throw console.error("Error creating employee:",o),o}}async updateEmployee(l,o){try{return(await ue.put(`${this.baseURL}/${l}`,o,{headers:this.getHeaders()})).data}catch(i){throw console.error("Error updating employee:",i),i}}async deleteEmployee(l){try{return(await ue.delete(`${this.baseURL}/${l}`,{headers:this.getHeaders()})).data}catch(o){throw console.error("Error deleting employee:",o),o}}async validatePin(l){var o;try{console.log("🔐 [API] Validating PIN:",l);const i=await ue.post(`${this.baseURL}/validate-pin`,{pin:l},{headers:this.getHeaders()});return console.log("🔐 [API] PIN validation response:",i.data),i.data}catch(i){throw console.error("❌ [API] Error validating PIN:",((o=i.response)==null?void 0:o.data)||i),i}}async changePin(l,o){try{return(await ue.put(`${this.baseURL}/${l}/change-pin`,{new_pin:o},{headers:this.getHeaders()})).data}catch(i){throw console.error("Error changing PIN:",i),i}}}const ta=new ea,oa={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},sa={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"},aa={class:"inline-block w-full max-w-md p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-lg"},la={class:"flex items-center justify-between mb-6"},na={class:"mb-6"},ra={class:"p-4 bg-yellow-50 border border-yellow-200 rounded-md"},ia={class:"text-sm text-yellow-800"},ua={class:"mb-6"},da={class:"flex gap-2 justify-center mb-2"},ca=["onUpdate:modelValue","onInput","onKeydown"],ma={key:0,class:"mb-6"},pa={class:"p-3 bg-red-50 border border-red-200 rounded-md"},va={class:"flex"},ga={class:"text-sm text-red-700"},fa={class:"flex gap-3"},ha=["disabled"],ya={key:0,class:"flex items-center justify-center"},xa={key:1},ba={key:1,class:"mt-4 text-center"},wa={class:"text-xs text-gray-500"},ka={__name:"SupervisorAuthModal",props:{modelValue:{type:Boolean,default:!1},action:{type:String,required:!0,validator:t=>["remove_payment","edit_cart_blocked","remove_item_blocked","apply_discount","cancel_sale","open_drawer"].includes(t)},required:{type:Boolean,default:!1}},emits:["update:modelValue","authorized","cancelled"],setup(t,{emit:l}){const o=t,i=l,r=w(["","","","","",""]),c=w([]),a=w(""),y=w(!1),k=w(0),V=H(()=>r.value.every($=>$!=="")),j=H(()=>r.value.join("")),h=H(()=>({remove_payment:"Eliminar un pago ya registrado",edit_cart_blocked:"Modificar carrito con pagos registrados",remove_item_blocked:"Quitar productos del carrito bloqueado",apply_discount:"Aplicar descuento mayor al permitido",cancel_sale:"Cancelar una venta con pagos",open_drawer:"Abrir cajón sin venta"})[o.action]||"Esta acción requiere autorización");Y(()=>o.modelValue,$=>{$&&(M(),le(()=>{c.value[0]&&c.value[0].focus()}))});const x=($,S)=>{const E=S.target.value;if(E&&!/^\d$/.test(E)){r.value[$]="";return}E&&$<5&&le(()=>{var g;(g=c.value[$+1])==null||g.focus()}),E&&$===5&&V.value&&le(()=>{O()}),a.value=""},P=($,S)=>{var E,g,v;S.key==="Backspace"&&!r.value[$]&&$>0&&((E=c.value[$-1])==null||E.focus()),S.key==="ArrowLeft"&&$>0&&((g=c.value[$-1])==null||g.focus()),S.key==="ArrowRight"&&$<5&&((v=c.value[$+1])==null||v.focus()),S.key==="Enter"&&V.value&&O(),S.key==="Escape"&&!o.required&&C()},T=$=>{$.preventDefault();const S=$.clipboardData.getData("text").trim();/^\d{6}$/.test(S)&&(r.value=S.split(""),le(()=>{var E;(E=c.value[5])==null||E.focus(),O()}))},O=async()=>{if(!(!V.value||y.value)){console.log("🔐 [AUTH] Attempting authorization:",{pin:j.value,action:o.action}),y.value=!0,a.value="";try{const $=await ta.validatePin(j.value);if(console.log("🔐 [AUTH] API response:",$),$.error===0&&$.data){const S=$.data;if(["supervisor","administrador"].includes(S.role)){const E={employeeId:S.id,employeeName:S.name,role:S.role,action:o.action,timestamp:new Date().toISOString()};console.log("✅ [AUTH] Authorization successful:",E),i("authorized",E),i("update:modelValue",!1),k.value=0}else k.value++,a.value=`El usuario ${S.name} no tiene permisos de supervisor`,console.warn("⚠️ [AUTH] Employee found but insufficient permissions:",S.role),I()}else k.value++,a.value=$.message||"PIN incorrecto o empleado no encontrado",console.warn("⚠️ [AUTH] Invalid PIN or employee not found"),k.value>=3?(a.value="Demasiados intentos fallidos. Contacte al administrador.",setTimeout(()=>{C()},3e3)):I()}catch($){k.value++,a.value="Error al validar PIN. Verifique su conexión.",console.error("❌ [AUTH] Error validating PIN:",$),k.value>=3?setTimeout(()=>{C()},3e3):I()}finally{y.value=!1}}},C=()=>{i("cancelled"),i("update:modelValue",!1),k.value=0},I=()=>{r.value=["","","","","",""],le(()=>{var $;($=c.value[0])==null||$.focus()})},M=()=>{I(),a.value="",y.value=!1};return($,S)=>t.modelValue?(d(),u("div",oa,[e("div",sa,[S[7]||(S[7]=e("div",{class:"fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75","aria-hidden":"true"},null,-1)),S[8]||(S[8]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",aa,[e("div",la,[S[1]||(S[1]=te('<div class="flex items-center" data-v-5cdd5c73><div class="flex items-center justify-center w-12 h-12 mr-4 bg-yellow-100 rounded-full" data-v-5cdd5c73><svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-5cdd5c73><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" data-v-5cdd5c73></path></svg></div><div data-v-5cdd5c73><h3 class="text-lg font-semibold text-gray-900" data-v-5cdd5c73>Autorización Requerida</h3><p class="text-sm text-gray-500" data-v-5cdd5c73>PIN de Supervisor</p></div></div>',1)),t.required?_("",!0):(d(),u("button",{key:0,onClick:C,class:"text-gray-400 hover:text-gray-500 focus:outline-none"},S[0]||(S[0]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])))]),e("div",na,[e("div",ra,[e("p",ia,[S[2]||(S[2]=e("strong",null,"Acción:",-1)),q(" "+f(h.value),1)])])]),e("div",ua,[S[3]||(S[3]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700"}," Ingrese PIN de 6 dígitos ",-1)),e("div",da,[(d(),u(Q,null,Z(6,E=>N(e("input",{key:E,ref_for:!0,ref:g=>c.value[E-1]=g,"onUpdate:modelValue":g=>r.value[E-1]=g,type:"password",maxlength:"1",inputmode:"numeric",pattern:"[0-9]",class:"w-12 h-14 text-2xl font-bold text-center border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 focus:outline-none",onInput:g=>x(E-1,g),onKeydown:g=>P(E-1,g),onPaste:T},null,40,ca),[[R,r.value[E-1]]])),64))]),S[4]||(S[4]=e("p",{class:"text-xs text-gray-500 text-center"}," Solo supervisores y administradores pueden autorizar esta acción ",-1))]),a.value?(d(),u("div",ma,[e("div",pa,[e("div",va,[S[5]||(S[5]=e("svg",{class:"w-5 h-5 text-red-400 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})],-1)),e("p",ga,f(a.value),1)])])])):_("",!0),e("div",fa,[e("button",{onClick:O,disabled:!V.value||y.value,class:"flex-1 px-4 py-3 text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-300 disabled:cursor-not-allowed font-medium transition-colors"},[y.value?(d(),u("span",ya,S[6]||(S[6]=[e("svg",{class:"animate-spin h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),q(" Validando... ")]))):(d(),u("span",xa,"Autorizar"))],8,ha),t.required?_("",!0):(d(),u("button",{key:0,onClick:C,class:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 font-medium transition-colors"}," Cancelar "))]),k.value>0?(d(),u("div",ba,[e("p",wa," Intentos fallidos: "+f(k.value)+"/3 ",1)])):_("",!0)])])])):_("",!0)}},Ca=Le(ka,[["__scopeId","data-v-5cdd5c73"]]),_a={class:"h-[calc(100dvh-4rem)] flex flex-col"},$a={class:"flex-1 flex overflow-hidden"},Sa={class:"w-2/3 bg-white flex flex-col overflow-hidden"},Aa={class:"flex-1 overflow-auto p-6"},Ea={class:"mb-6 search-container relative"},Pa={class:"flex"},Ia={key:0,class:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-lg max-h-60 overflow-auto"},Da=["onClick"],Va={class:"flex justify-between"},ja={class:"text-gray-600"},Ma={class:"text-sm text-gray-500"},Ta={class:"overflow-x-auto"},Na={class:"min-w-full divide-y divide-gray-200"},Ra={class:"bg-white divide-y divide-gray-200"},Ba={class:"px-6 py-4 whitespace-nowrap"},Oa={class:"text-sm font-medium text-gray-900"},Ua={class:"text-sm text-gray-500"},La={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},za={class:"px-6 py-4 whitespace-nowrap"},qa={class:"flex items-center"},Fa=["onClick","disabled"],Ha={class:"mx-2 text-sm"},Qa=["onClick","disabled"],Ga={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ka={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Za=["onClick"],Wa={key:0},Ja={class:"w-1/3 bg-gray-50 flex flex-col overflow-hidden"},Ya={class:"p-6 flex flex-col h-full"},Xa={class:"flex space-x-2 mb-4"},el=["disabled"],tl={class:"mb-4"},ol={key:0},sl={key:0},al={class:"bg-white p-4 rounded-lg shadow-sm mb-4"},ll={class:"space-y-2"},nl={class:"flex justify-between"},rl={class:"flex justify-between"},il={class:"border-t pt-2 mt-2 flex justify-between font-medium"},ul={key:0,class:"mt-4"},dl={class:"space-y-2"},cl={class:"flex items-center"},ml={class:"font-medium text-sm"},pl={key:0,class:"ml-2 text-xs text-gray-500"},vl={class:"flex items-center"},gl={class:"font-medium"},fl=["onClick"],hl={class:"flex justify-between mt-3 font-medium text-green-700"},yl={key:0,class:"flex justify-between font-medium text-blue-600"},xl={class:"flex-shrink-0 mt-auto space-y-4"},bl=["disabled"],wl=["disabled"],kl={key:0,class:"animate-spin h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Cl={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},_l={class:"flex space-x-2"},$l=["disabled"],Sl={key:0,class:"fixed z-10 inset-0 overflow-y-auto"},Al={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},El={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full"},Pl={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Il={class:"sm:flex sm:items-start"},Dl={class:"w-full"},Vl={class:"mb-4 grid grid-cols-2 gap-4"},jl=["value"],Ml={class:"overflow-x-auto"},Tl={class:"min-w-full divide-y divide-gray-200 table-fixed"},Nl={class:"bg-white divide-y divide-gray-200"},Rl={class:"px-6 py-4 whitespace-nowrap text-sm"},Bl={class:"px-6 py-4 text-sm truncate max-w-xs"},Ol={class:"px-6 py-4 text-sm truncate"},Ul={class:"px-6 py-4 whitespace-nowrap text-sm"},Ll={class:"px-6 py-4 whitespace-nowrap text-sm"},zl=["onClick","disabled"],Kl={__name:"POS",setup(t){et();const l=ze(),o=it(),i=tt(),{items:r,payments:c,customer:a,status:y,currentSaleId:k,documentType:V}=ot(o),j=w([]),h=w([]),x=w([]),P=w(""),T=w(null),O=w(""),C=w([]),I=w(""),M=w("");w([]);const $=w(!1),S=w(!1),E=w(!1),g=w(!1),v=w(!1),D=w(!1),X=w(!1),J=w({type:null,data:null}),Ce=H(()=>{let p=[...x.value];if(I.value){const n=I.value.toLowerCase();p=p.filter(m=>m.nombre.toLowerCase().includes(n)||(m.sku?String(m.sku).toLowerCase().includes(n):!1))}return M.value&&(p=p.filter(n=>n.categoria===M.value)),p}),oe=H(()=>o.subtotal),ve=H(()=>o.tax),re=H(()=>o.total),_e=H(()=>o.totalPaid),se=H(()=>o.remainingAmount),K=H(()=>o.totalChange),W=p=>isNaN(p)||p===null||p===void 0?"S/ 0.00":new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(p),$e=p=>{const n=parseFloat(p.precio)||0,m=parseInt(p.quantity)||0;return n*m},Se=async()=>{var p;if(P.value)try{const n=await ke.searchByCode(P.value);if(n.success&&n.data){const m={id:n.data.id,sku:n.data.sku||"",nombre:n.data.name,precio:n.data.price,stock:n.data.stock,categoria:((p=n.data.category)==null?void 0:p.name)||"Sin categoría",images:n.data.images||[]};m.stock>0?fe(m):alert("Este producto está agotado")}else alert("Producto no encontrado");P.value="",T.value.focus()}catch(n){console.error("Error searching product:",n),alert("Error al buscar el producto")}},fe=p=>{try{if(o.status==="BLOQUEADO"){J.value={type:"add_item_blocked",data:p},D.value=!0;return}o.addItem(p)}catch(n){alert(n.message)}},U=p=>{try{if(!o.canEditQuantity){J.value={type:"increment_quantity",data:p},D.value=!0;return}o.incrementQuantity(p.id)}catch(n){alert(n.message)}},A=p=>{try{if(!o.canEditQuantity){J.value={type:"decrement_quantity",data:p},D.value=!0;return}o.decrementQuantity(p.id)}catch(n){alert(n.message)}},s=p=>{try{if(!o.canRemoveProducts){J.value={type:"remove_item",data:p},D.value=!0;return}o.removeItem(p.id)}catch(n){alert(n.message)}},b=()=>{if(r.value.length===0){alert("No hay productos en la venta para guardar");return}Re(),saleHasUnsavedChanges.value=!1,alert("Venta guardada correctamente")},L=()=>{r.value.length>0&&saleHasUnsavedChanges.value&&(confirm("¿Desea guardar la venta actual antes de iniciar una nueva?")?b():xe()),k.value=null,v.value=!0},ae=p=>{xe(),p.customer&&(a.value=p.customer),saleHasUnsavedChanges.value=!1},he=p=>{r.value.length>0&&confirm("¿Desea guardar la venta actual antes de cargar la venta guardada?")&&b(),r.value=[...p.items],a.value=p.customer,k.value=p.id,p.payments&&Array.isArray(p.payments)?c.value=[...p.payments]:c.value=[],saleHasUnsavedChanges.value=!1},Ae=()=>{if(!i.hasActiveShift){console.error("❌ [POS] No active shift - cannot process payment"),alert(`⚠️ No hay turno de caja abierto. No se pueden registrar pagos.

Debes abrir un turno primero desde el menú principal.`);return}se.value>0?S.value=!0:c.value.length>0&&je()},ye=p=>{var n;if(!i.hasActiveShift){console.error("❌ [POS] No active shift - cannot add payment"),alert("⚠️ No hay turno de caja abierto. No se pueden registrar pagos.");return}try{console.log("💳 [POS] Adding payment - shift active:",(n=i.activeShift)==null?void 0:n.id),o.addPayment({method:p.method,methodName:Je(p.method),amount:p.amount,reference:p.reference})}catch(m){alert(m.message)}},ce=w(!1),je=async()=>{var p,n,m,z,Ee,Be;if(ce.value){console.log("Order already being processed, ignoring duplicate request");return}ce.value=!0;try{const ge={customer_id:a.value?a.value.id:null,customer_name:a.value?a.value.name:"Cliente General",customer_email:((p=a.value)==null?void 0:p.email)||"",customer_phone:((n=a.value)==null?void 0:n.phone)||"",customer_document:((m=a.value)==null?void 0:m.document_number)||"",document_type:V.value,items:r.value.map(B=>({product_id:B.id,sku:B.sku,name:B.nombre,quantity:B.quantity,unit_price:B.precio,subtotal:B.precio*B.quantity,tax:B.precio*B.quantity*.18,total:B.precio*B.quantity*1.18})),payments:c.value.map(B=>({method:B.method,method_name:B.methodName,amount:B.amount,reference:B.reference||null})),subtotal:oe.value,tax:ve.value,tax_rate:.18,total:re.value,currency:"PEN"},ie=await at.createOrder(ge);if(ie.success){console.log("Orden creada exitosamente:",ie.data);for(const B of r.value){const Pe=B.stock-B.quantity;await ke.updateStock(B.id,Pe)}if(i.hasActiveShift){const B=i.activeShift.id,Pe=`VENTA-${ie.data.order_id||ie.data.id||Date.now()}`,Ye=((z=a.value)==null?void 0:z.name)||"Cliente General";console.log("💰 [POS] Registering cash movements for shift:",B);for(const me of c.value)try{await dt.registerSale(B,me.method,me.amount,Pe,Ye),console.log(`✅ [POS] Movement registered: ${me.method} - S/ ${me.amount}`)}catch(Xe){console.error("❌ [POS] Error registering movement:",Xe)}try{await i.fetchActiveShift()}catch(me){console.error("Error updating shift data:",me)}}else console.warn("⚠️ [POS] No active shift - movements not registered");k.value&&l.deleteSavedSale(k.value),X.value=!0}else throw new Error(ie.message||"Error al crear la orden")}catch(ge){console.error("Error al procesar el pago:",ge);const ie=((Be=(Ee=ge.response)==null?void 0:Ee.data)==null?void 0:Be.message)||ge.message||"Error al procesar la venta";alert(`Error: ${ie}

Por favor, intente nuevamente.`)}finally{ce.value=!1}},qe=()=>{confirm("¿Está seguro de cancelar la venta?")&&xe()},xe=()=>{o.reset(),O.value="",C.value=[],saleHasUnsavedChanges.value=!1},Fe=async()=>{try{const p=await ut.getCustomers();j.value=p.data}catch(p){console.error("Error fetching customers:",p)}},He=async()=>{if(!P.value){C.value=[];return}try{const p=await ke.getProducts({search:P.value,limit:5,published:!0});p.success&&(C.value=p.data.map(n=>{var m;return{id:n.id,sku:n.sku?String(n.sku):"",nombre:n.name,precio:n.price,stock:n.stock,categoria:((m=n.category)==null?void 0:m.name)||"Sin categoría",images:n.images||[]}}))}catch(p){console.error("Error searching products:",p),C.value=[]}},Me=p=>{const n={...p,sku:p.sku?String(p.sku):""};n.stock>0?(fe(n),C.value=[],P.value="",be()):alert("Este producto está agotado")},Qe=async()=>{try{const p=await ke.getProducts({limit:100,published:!0});if(p.success){const n=new Set;p.data.forEach(m=>{var z;(z=m.category)!=null&&z.name&&n.add(m.category.name)}),h.value=Array.from(n),x.value=p.data.map(m=>{var z;return{id:m.id,sku:m.sku?String(m.sku):"",nombre:m.name,precio:m.price,stock:m.stock,categoria:((z=m.category)==null?void 0:z.name)||"Sin categoría",images:m.images||[]}})}$.value=!0}catch(p){console.error("Error loading product list:",p),alert("Error al cargar la lista de productos")}},be=()=>{$.value=!1,I.value="",M.value=""},Te=()=>{},Ne=p=>{p.target.closest(".search-container")||(C.value=[])},Ge=p=>{console.log("🎯 POS: Customer selected:",p),console.log("🎯 POS: Customer name:",p==null?void 0:p.name),a.value=p,console.log("🎯 POS: selectedCustomer updated:",a.value)};Ue(async()=>{Fe(),await le(),T.value&&T.value.focus(),document.addEventListener("click",Ne)}),st(()=>{document.removeEventListener("click",Ne)}),Y([r,c,a],()=>{r.value.length>0&&(Re(),saleHasUnsavedChanges.value=!1)},{deep:!0});const Re=()=>{if(!r.value.length)return;const p={customer:a.value,items:[...r.value],subtotal:oe.value,tax:ve.value,total:re.value,payments:[...c.value]};if(k.value)l.updateSale(k.value,p);else{const n=l.saveSale(p);k.value=n}};Y(S,p=>{});const Ke=p=>{J.value={type:"remove_payment",data:{index:p}},D.value=!0},Ze=p=>{const{type:n,data:m}=J.value;console.log("✅ [POS] Supervisor authorized:",{action:n,authData:p,pendingData:m});try{switch(n){case"add_item_blocked":console.log("➕ [POS] Adding item with authorization"),o.addItem(m,p);break;case"increment_quantity":console.log("⬆️ [POS] Incrementing quantity with authorization"),o.incrementQuantity(m.id,p);break;case"decrement_quantity":console.log("⬇️ [POS] Decrementing quantity with authorization"),o.decrementQuantity(m.id,p);break;case"remove_item":console.log("🗑️ [POS] Removing item with supervisor authorization"),o.removeItem(m.id,p);break;case"remove_payment":console.log("💳 [POS] Removing payment with supervisor authorization"),o.removePayment(m.index,p);break;default:console.warn("⚠️ [POS] Unhandled action:",n)}J.value={type:null,data:null}}catch(z){console.error("❌ [POS] Error executing authorized action:",z),alert(z.message)}},We=()=>{J.value={type:null,data:null}},Je=p=>({efectivo:"Efectivo",tarjeta:"Tarjeta de crédito/débito",qr:"Pago con QR",credito:"Crédito",giftcard:"Gift Card",puntos:"Puntos"})[p]||"";return(p,n)=>(d(),u(Q,null,[e("div",_a,[e("div",$a,[e("div",Sa,[n[16]||(n[16]=e("header",{class:"bg-white shadow px-6 py-4 flex-shrink-0 flex justify-between items-center"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"Ventas")],-1)),e("div",Aa,[e("div",Ea,[e("div",Pa,[N(e("input",{ref_key:"barcodeInput",ref:T,"onUpdate:modelValue":n[0]||(n[0]=m=>P.value=m),type:"text",placeholder:"Escanear código de barras o buscar producto...",class:"flex-grow p-2 border rounded-l-lg focus:ring-2 focus:ring-blue-500",onKeyup:Ve(Se,["enter"]),onInput:He},null,544),[[R,P.value]]),e("button",{onClick:Qe,class:"bg-blue-500 text-white p-2 rounded-r-lg hover:bg-blue-600"},n[10]||(n[10]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})],-1)]))]),C.value.length>0?(d(),u("div",Ia,[e("ul",null,[(d(!0),u(Q,null,Z(C.value,m=>(d(),u("li",{key:m.id,class:"p-2 hover:bg-gray-100 cursor-pointer",onClick:z=>Me(m)},[e("div",Va,[e("span",null,f(m.nombre),1),e("span",ja,f(W(m.precio)),1)]),e("div",Ma,"SKU: "+f(m.sku)+" | Stock: "+f(m.stock),1)],8,Da))),128))])])):_("",!0)]),e("div",Ta,[e("table",Na,[n[15]||(n[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Producto"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Precio"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Cantidad"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Subtotal"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Acciones")])],-1)),e("tbody",Ra,[(d(!0),u(Q,null,Z(F(r),m=>(d(),u("tr",{key:m.id},[e("td",Ba,[e("div",Oa,f(m.nombre),1),e("div",Ua,"SKU: "+f(m.sku),1)]),e("td",La,f(W(m.precio)),1),e("td",za,[e("div",qa,[e("button",{onClick:z=>A(m),class:"p-1 rounded-full hover:bg-gray-200",disabled:m.quantity<=1},n[11]||(n[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)]),8,Fa),e("span",Ha,f(m.quantity),1),e("button",{onClick:z=>U(m),class:"p-1 rounded-full hover:bg-gray-200",disabled:m.quantity>=m.stock},n[12]||(n[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)]),8,Qa)])]),e("td",Ga,f(W($e(m))),1),e("td",Ka,[e("button",{onClick:z=>s(m),class:"text-red-600 hover:text-red-900"},n[13]||(n[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M3 6h18"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)]),8,Za)])]))),128)),F(r).length===0?(d(),u("tr",Wa,n[14]||(n[14]=[e("td",{colspan:"5",class:"px-6 py-8 text-center text-gray-500"}," No hay productos en el carrito ",-1)]))):_("",!0)])])])])]),e("div",Ja,[e("div",Ya,[e("div",Xa,[e("button",{onClick:n[1]||(n[1]=m=>g.value=!0),class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200"},n[17]||(n[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),e("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})],-1),q(" Ventas Guardadas ")])),e("button",{onClick:b,disabled:!F(r).length,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200"},n[18]||(n[18]=[te('<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v8"></path><path d="m16 6-4 4-4-4"></path><rect width="20" height="8" x="2" y="14" rx="2"></rect><path d="M6 18h.01"></path><path d="M10 18h.01"></path></svg> Guardar Venta ',2)]),8,el),e("button",{onClick:L,class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200"},n[19]||(n[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1),q(" Nueva Venta ")]))]),e("div",tl,[F(a)?(d(),u("span",ol,[n[20]||(n[20]=e("strong",null,"Cliente:",-1)),q(" "+f(F(a).name)+" ",1),F(a).document_number?(d(),u("span",sl," ("+f(F(a).document_type==="1"?"DNI":"RUC")+": "+f(F(a).document_number)+") ",1)):_("",!0)])):_("",!0)]),e("div",al,[n[29]||(n[29]=e("h2",{class:"text-lg font-medium mb-4"},"Resumen de la Orden",-1)),e("div",ll,[e("div",nl,[n[21]||(n[21]=e("span",{class:"text-gray-600"},"Subtotal",-1)),e("span",null,f(W(oe.value)),1)]),e("div",rl,[n[22]||(n[22]=e("span",{class:"text-gray-600"},"IGV (18%)",-1)),e("span",null,f(W(ve.value)),1)]),e("div",il,[n[23]||(n[23]=e("span",null,"Total",-1)),e("span",null,f(W(re.value)),1)]),F(c).length>0?(d(),u("div",ul,[n[28]||(n[28]=e("div",{class:"border-t pt-3 mb-2"},[e("h3",{class:"font-medium text-gray-700"},"Pagos Realizados:")],-1)),e("div",dl,[(d(!0),u(Q,null,Z(F(c),(m,z)=>(d(),u("div",{key:z,class:"flex justify-between items-center p-2 bg-gray-50 rounded-lg border border-gray-200"},[e("div",cl,[e("span",ml,f(m.methodName),1),m.reference?(d(),u("span",pl,f(m.reference),1)):_("",!0)]),e("div",vl,[e("span",gl,f(W(m.amount)),1),e("button",{onClick:Ee=>Ke(z),class:"ml-2 text-red-600 hover:text-red-800"},n[24]||(n[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M18 6L6 18M6 6l12 12"})],-1)]),8,fl)])]))),128))]),e("div",hl,[n[25]||(n[25]=e("span",null,"Pagado:",-1)),e("span",null,f(W(_e.value)),1)]),K.value>0?(d(),u("div",yl,[n[26]||(n[26]=e("span",null,"Cambio:",-1)),e("span",null,f(W(K.value)),1)])):_("",!0),e("div",{class:G(["flex justify-between font-medium",se.value===0?"text-green-700":"text-red-600"])},[n[27]||(n[27]=e("span",null,"Saldo pendiente:",-1)),e("span",null,f(W(se.value)),1)],2)])):_("",!0)])]),e("div",xl,[F(c).length===0||se.value>0?(d(),u("button",{key:0,onClick:Ae,disabled:!F(r).length,class:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors duration-200 flex items-center justify-center"},n[30]||(n[30]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("rect",{x:"1",y:"4",width:"22",height:"16",rx:"2",ry:"2"}),e("line",{x1:"1",y1:"10",x2:"23",y2:"10"})],-1),q(" Añadir Pago ")]),8,bl)):_("",!0),F(c).length>0&&se.value===0?(d(),u("button",{key:1,onClick:je,disabled:ce.value,class:"w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center"},[ce.value?(d(),u("svg",kl,n[31]||(n[31]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(d(),u("svg",Cl,n[32]||(n[32]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)]))),q(" "+f(ce.value?"Procesando...":"Completar Venta"),1)],8,wl)):_("",!0),e("div",_l,[e("button",{onClick:qe,disabled:!F(r).length,class:"flex-1 bg-red-600 text-white py-3 px-4 rounded-lg hover:bg-red-700 disabled:opacity-50 transition-colors duration-200"}," Cancelar ",8,$l)])])])])])]),$.value?(d(),u("div",Sl,[e("div",Al,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:be}),e("div",El,[e("div",Pl,[e("div",Il,[e("div",Dl,[e("div",{class:"flex justify-between items-center mb-4"},[n[34]||(n[34]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Lista de Productos",-1)),e("button",{onClick:be,class:"text-gray-400 hover:text-gray-500 focus:outline-none"},n[33]||(n[33]=[e("svg",{class:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Vl,[N(e("input",{"onUpdate:modelValue":n[2]||(n[2]=m=>I.value=m),type:"text",placeholder:"Buscar productos...",class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",onInput:Te},null,544),[[R,I.value]]),N(e("select",{"onUpdate:modelValue":n[3]||(n[3]=m=>M.value=m),class:"p-2 border rounded-lg focus:ring-2 focus:ring-blue-500",onChange:Te},[n[35]||(n[35]=e("option",{value:""},"Todas las categorías",-1)),(d(!0),u(Q,null,Z(h.value,m=>(d(),u("option",{key:m,value:m},f(m),9,jl))),128))],544),[[De,M.value]])]),e("div",Ml,[e("table",Tl,[n[36]||(n[36]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/6"},"SKU"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase w-2/6"},"Producto"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/6"},"Categoría"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/6"},"Precio"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase w-1/6"},"Acciones")])],-1)),e("tbody",Nl,[(d(!0),u(Q,null,Z(Ce.value,m=>(d(),u("tr",{key:m.id},[e("td",Rl,f(m.sku),1),e("td",Bl,f(m.nombre),1),e("td",Ol,f(m.categoria),1),e("td",Ul,f(W(m.precio)),1),e("td",Ll,[e("button",{onClick:z=>Me(m),disabled:m.stock===0,class:"text-indigo-600 hover:text-indigo-900 disabled:opacity-50 disabled:cursor-not-allowed"}," Agregar ",8,zl)])]))),128))])])])])])]),e("div",{class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},[e("button",{type:"button",onClick:be,class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," Cerrar ")])])])])):_("",!0),ne(Ys,{modelValue:v.value,"onUpdate:modelValue":n[4]||(n[4]=m=>v.value=m),onStart:ae},null,8,["modelValue"]),ne(Rt,{modelValue:E.value,"onUpdate:modelValue":n[5]||(n[5]=m=>E.value=m),onSelect:Ge},null,8,["modelValue"]),ne(cs,{modelValue:S.value,"onUpdate:modelValue":n[6]||(n[6]=m=>S.value=m),total:re.value,customer:F(a),items:F(r),payments:F(c),"document-type":F(V),"remaining-amount":se.value,"show-ticket":X.value,onPaymentAdded:ye,onSaleFinalized:xe,"onUpdate:showTicket":n[7]||(n[7]=m=>X.value=m)},null,8,["modelValue","total","customer","items","payments","document-type","remaining-amount","show-ticket"]),ne(Is,{modelValue:g.value,"onUpdate:modelValue":n[8]||(n[8]=m=>g.value=m),onResumeSale:he},null,8,["modelValue"]),ne(Ca,{modelValue:D.value,"onUpdate:modelValue":n[9]||(n[9]=m=>D.value=m),action:J.value.type,onAuthorized:Ze,onCancelled:We},null,8,["modelValue","action"])],64))}};export{Kl as default};
