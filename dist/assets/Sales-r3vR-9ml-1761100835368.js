import{g as l,q as F,y as O,c as i,d as e,i as v,v as h,s as S,f as _,t as r,F as B,r as L,H as z,o as d,n as M,h as U,E as $,j as q}from"./index-Drmr0K2a-1761100835368.js";import{o as R}from"./ordersApi-CSK52s1q-1761100835368.js";const G={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},H={class:"px-4 py-6 sm:px-0"},W={class:"mb-6"},Q={class:"bg-white shadow rounded-lg p-4"},J={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},K={class:"relative"},X={key:0,class:"bg-white shadow overflow-hidden sm:rounded-lg p-6"},Y={key:1,class:"bg-white shadow overflow-hidden sm:rounded-lg p-6"},Z={class:"flex flex-col items-center justify-center py-12"},ee={class:"text-gray-600 text-center max-w-md mb-4"},te={key:2,class:"bg-white shadow overflow-hidden sm:rounded-lg"},se={class:"overflow-x-auto"},ae={class:"min-w-full divide-y divide-gray-200"},oe={class:"bg-white divide-y divide-gray-200"},ne={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},re={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600"},de={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium"},ue={class:"px-6 py-4 whitespace-nowrap"},ce={class:"px-6 py-4 whitespace-nowrap"},pe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},xe={key:3,class:"bg-white shadow overflow-hidden sm:rounded-lg p-6"},be={__name:"Sales",setup(ge){const b=()=>new Date().toISOString().split("T")[0],u=l([]),w=l(!1),f=l(null),c=l(""),p=l("web"),x=l("1"),g=l(b()),m=l(b()),k=F(()=>{if(!c.value)return u.value;const s=c.value.toLowerCase();return u.value.filter(t=>{var C;const a=(((C=t.customer)==null?void 0:C.name)||"").toLowerCase(),o=(t.order_number||"").toString().toLowerCase(),y=(t.id||"").toString().toLowerCase();return a.includes(s)||o.includes(s)||y.includes(s)})}),n=async()=>{w.value=!0,f.value=null;try{const s={limit:100};p.value&&(s.source=p.value),x.value&&(s.status=x.value),g.value&&(s.date_from=g.value),m.value&&(s.date_to=m.value);const t=await R.getOrders(s);console.log("Orders API Response:",t),t.orders?u.value=t.orders.map(a=>({id:parseInt(a.tiendaventa_id),order_number:a.tiendaventa_codigoreferencia,customer:{name:`${a.tiendaventa_nombres||""} ${a.tiendaventa_apellidos||""}`.trim()||"Cliente General",email:a.tiendaventa_correoelectronico,phone:a.tiendaventa_telefono},cajero_nombre:a.cajero_nombre||null,total:parseFloat(a.tiendaventa_totalpagar||"0"),status:a.tiendaventa_pagado,source:a.tiendaventa_origen||"web",created_at:a.tiendaventa_fecha,_raw:a})):Array.isArray(t)?u.value=t.map(a=>({id:parseInt(a.tiendaventa_id||a.id),order_number:a.tiendaventa_codigoreferencia||a.order_number,customer:{name:`${a.tiendaventa_nombres||""} ${a.tiendaventa_apellidos||""}`.trim()||"Cliente General"},cajero_nombre:a.cajero_nombre||null,total:parseFloat(a.tiendaventa_totalpagar||a.total||"0"),status:a.tiendaventa_pagado||a.status,source:a.tiendaventa_origen||a.source||"web",created_at:a.tiendaventa_fecha||a.created_at,_raw:a})):u.value=[]}catch(s){console.error("Error fetching orders:",s),f.value=s.message||"Error al cargar las ventas"}finally{w.value=!1}},j=()=>{},A=s=>s?new Date(s).toLocaleString("es-PE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",N=s=>isNaN(s)||s===null||s===void 0?"S/ 0.00":new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(s),T=s=>({0:"Rechazado",1:"Aprobado",2:"Pendiente",9:"Creado"})[s]||"Desconocido",V=s=>({0:"bg-red-100 text-red-800",1:"bg-green-100 text-green-800",2:"bg-yellow-100 text-yellow-800",9:"bg-gray-100 text-gray-800"})[s]||"bg-gray-100 text-gray-800",D=s=>({pos:"POS",web:"Web",api:"API"})[s]||s||"Web",E=s=>({pos:"bg-purple-100 text-purple-800",web:"bg-blue-100 text-blue-800",api:"bg-indigo-100 text-indigo-800"})[s]||"bg-blue-100 text-blue-800",I=(s,t)=>s.length<=t?s:s.substring(0,t)+"...",P=()=>{c.value="",p.value="web",x.value="1",g.value=b(),m.value=b(),n()};return O(()=>{n()}),(s,t)=>{const a=z("router-link");return d(),i("div",G,[e("div",H,[e("div",W,[e("div",{class:"flex justify-between items-center mb-4"},[t[5]||(t[5]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Historial de Ventas",-1)),e("button",{onClick:n,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," Actualizar ")]),e("div",Q,[e("div",J,[e("div",K,[t[6]||(t[6]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Buscar",-1)),v(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>c.value=o),type:"text",placeholder:"Cliente o número...",class:"w-full p-2 pr-8 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",onInput:j},null,544),[[h,c.value]]),t[7]||(t[7]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 absolute right-2 top-9 text-gray-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})],-1))]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Estado",-1)),v(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>x.value=o),class:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",onChange:n},t[8]||(t[8]=[_('<option value="">Todos</option><option value="1">Aprobado</option><option value="2">Pendiente</option><option value="0">Rechazado</option><option value="9">Creado</option>',5)]),544),[[S,x.value]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Fuente",-1)),v(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>p.value=o),class:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",onChange:n},t[10]||(t[10]=[e("option",{value:""},"Todas",-1),e("option",{value:"pos"},"POS",-1),e("option",{value:"web"},"Web",-1),e("option",{value:"api"},"API",-1)]),544),[[S,p.value]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Desde",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>g.value=o),type:"date",class:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",onChange:n},null,544),[[h,g.value]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Hasta",-1)),v(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>m.value=o),type:"date",class:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 text-sm",onChange:n},null,544),[[h,m.value]])])]),e("div",{class:"mt-3 flex justify-end"},[e("button",{onClick:P,class:"text-sm text-gray-600 hover:text-gray-900"}," Limpiar filtros ")])])]),w.value?(d(),i("div",X,t[14]||(t[14]=[e("div",{class:"flex flex-col items-center justify-center py-12"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),e("p",{class:"text-gray-600"},"Cargando ventas...")],-1)]))):f.value?(d(),i("div",Y,[e("div",Z,[t[15]||(t[15]=_('<svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 text-red-500 mb-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg><h2 class="text-xl font-medium text-gray-900 mb-2">Error al cargar ventas</h2>',2)),e("p",ee,r(f.value),1),e("button",{onClick:n,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," Reintentar ")])])):k.value.length>0?(d(),i("div",te,[e("div",se,[e("table",ae,[t[17]||(t[17]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ID"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fecha"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cliente"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cajero"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Total"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Origen"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Acciones")])],-1)),e("tbody",oe,[(d(!0),i(B,null,L(k.value,o=>{var y;return d(),i("tr",{key:o.id,class:"hover:bg-gray-50"},[e("td",ne,r(o.order_number||o.id),1),e("td",le,r(A(o.created_at)),1),e("td",re,r(I(((y=o.customer)==null?void 0:y.name)||"Cliente General",36)),1),e("td",ie,r(o.cajero_nombre||"-"),1),e("td",de,r(N(o.total)),1),e("td",ue,[e("span",{class:M([V(o.status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},r(T(o.status)),3)]),e("td",ce,[e("span",{class:M([E(o.source),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},r(D(o.source)),3)]),e("td",pe,[U(a,{to:`/sales/${o.id}`,class:"text-blue-600 hover:text-blue-900 mr-3"},{default:$(()=>t[16]||(t[16]=[q(" Ver Detalle ")])),_:2},1032,["to"])])])}),128))])])])])):(d(),i("div",xe,t[18]||(t[18]=[_('<div class="flex flex-col items-center justify-center py-12"><svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 text-gray-400 mb-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"></path><path d="M7 12h10"></path><path d="M7 16h10"></path></svg><h2 class="text-xl font-medium text-gray-900 mb-2">No hay ventas</h2><p class="text-gray-600 text-center max-w-md"> Aún no se han registrado ventas. Las ventas aparecerán aquí una vez que se procesen. </p></div>',1)])))])])}}};export{be as default};
